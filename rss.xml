<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[wasabigeek's blog]]></title><description><![CDATA[A blog by a Business grad turned Software Engineer, mostly relating to Ruby and Rails. Nothing to do with actual wasabi.]]></description><link>https://www.wasabigeek.com</link><generator>GatsbyJS</generator><lastBuildDate>Tue, 22 Mar 2022 14:10:27 GMT</lastBuildDate><item><title><![CDATA[Why is Polymorphism important?]]></title><description><![CDATA[When I first came across the concept of Polymorphism in Object-Oriented Programming (OOP), it wasn’t obvious to me why it was important. The…]]></description><link>https://www.wasabigeek.com/blog/why-is-polymorphism-important/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/why-is-polymorphism-important/</guid><pubDate>Sun, 20 Mar 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;When I first came across the concept of Polymorphism in Object-Oriented Programming (OOP), it wasn’t obvious to me &lt;em&gt;why&lt;/em&gt; it was important. The top search results generally explain &lt;em&gt;what&lt;/em&gt; it is and &lt;em&gt;how&lt;/em&gt; to use it, but handwave the &lt;em&gt;why&lt;/em&gt; and treat it as yet-another-language-feature. &lt;/p&gt;
&lt;p&gt;A &lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2018/04/13/FPvsOO.html&quot;&gt;blog post&lt;/a&gt; by Robert Martin (who coined the SOLID acronym) caught my eye recently, in particular this statement:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;…the thing that truly differentiates OO programs from non-OO programs is polymorphism.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Whoa! Now he doesn’t mean that encapsulation and other “OOP” concepts aren’t important - the argument is that they are achievable in “non-OOP” as well, but not polymorphism. If polymorphism is a defining aspect of OOP, shouldn’t we build a stronger intuition for &lt;em&gt;why&lt;/em&gt; it’s important?&lt;/p&gt;
&lt;h2&gt;What is polymorphism?&lt;/h2&gt;
&lt;p&gt;Let’s set the stage by aligning on what Polymorphism in OOP is. In the same post, Martin explains Polymorphism as different kinds of objects being able to accept the same message, implementing their own behaviour. I’ll paraphase his example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;some_object.do_the_right_thing(input)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We don’t actually know what &lt;code class=&quot;language-text&quot;&gt;some_object&lt;/code&gt; is! Many different implementations could replace &lt;code class=&quot;language-text&quot;&gt;some_object&lt;/code&gt;, and the program would still run as long as they had the same interface (i.e. have the method &lt;code class=&quot;language-text&quot;&gt;#do_the_right_thing&lt;/code&gt;).&lt;/p&gt;
&lt;h2&gt;Why polymorphism?&lt;/h2&gt;
&lt;p&gt;In another &lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html&quot;&gt;blog post&lt;/a&gt;, Martin says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There really is only one benefit to Polymorphism; but it’s a big one. It is the inversion of source code and run time dependencies.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let’s concretise this with an example: caching in a web framework like Rails. There are multiple options out there for caches - for example, Rails supports a &lt;code class=&quot;language-text&quot;&gt;FileStore&lt;/code&gt;, a &lt;code class=&quot;language-text&quot;&gt;MemCacheStore&lt;/code&gt; and a &lt;code class=&quot;language-text&quot;&gt;RedisCacheStore&lt;/code&gt;. For the sake of illustration, imagine that the caches all had their own interfaces:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;example_method&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# do stuff&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_a&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; NaiveFileStore
    data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;search_for&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;elsif&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_a&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; NaiveRedisCacheStore
    data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# do more stuff&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Above, our &lt;code class=&quot;language-text&quot;&gt;example_method&lt;/code&gt; has a direct dependency on &lt;code class=&quot;language-text&quot;&gt;NaiveFileStore&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;NaiveRedisCacheStore&lt;/code&gt;. If their interfaces change, or new kinds of stores are supported, it will require changes in &lt;code class=&quot;language-text&quot;&gt;example_method&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Martin talks about an inversion of dependencies (D in SOLID) - practically this means  &lt;code class=&quot;language-text&quot;&gt;example_method&lt;/code&gt; and the different cache stores instead depend on an agreed interface. This makes all cache stores polymorphic! In Rails all &lt;a href=&quot;https://guides.rubyonrails.org/caching_with_rails.html#activesupport-cache-store&quot;&gt;cache stores&lt;/a&gt; implement a &lt;code class=&quot;language-text&quot;&gt;#fetch&lt;/code&gt; method, so the above becomes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;example_method&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# do stuff&lt;/span&gt;
  data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# do more stuff&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The code in &lt;code class=&quot;language-text&quot;&gt;example_method&lt;/code&gt; is more concise now, but that’s a side benefit; what’s important is it’s shielded from knowledge of which exact cache store is used, and how the store works. It just knows that &lt;em&gt;some&lt;/em&gt; cache store exists (&lt;code class=&quot;language-text&quot;&gt;Rails.cache&lt;/code&gt;), and the cache store has agreed to implement &lt;code class=&quot;language-text&quot;&gt;#fetch&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;We can visualise the  change in “dependency directions” (the arrows) below:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 78.37837837837837%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQ4y42UiaoqQQxE+/+/wj9RxF0QBUVEwQX3fd+1LieXXAZxHi8QMtNLdSWp7pDJZIQXi0Vls1m1220tFguNx2NNJhO932/F2be5cLlcdL/f9Xw+LZ5OJx0OB4ur1Ur7/V6scWf8eDz+gX2ChsfjIRwwoi9i83Q61fV61XA4VK/XU7/ft39AIfAV8Hw+2wJnttlszAHnn3lY7nY7bbdbA4Th6/X6DtjtdjUajTQYDLRcLm3j7XazSVhwECDuHIDH1TFwGkxwmDgbUqY5pMuBNIlIo6htbA0ZiDpGOrCczWYGQJzP5xY5hNRjU9Y/jDrC1NPlECJjn0Tcg0sh2pxojT5158ziLKTTaeXzeVWrVeVyORN3qVSyVJEN9SJdvqNS+caaGNbrtTWC5nhTvDGAuVyQktcLzbIGMPaREXPlcvm3htFmuH2mxhqXEeB+wzqdjnUfSyaTCtwA1yFdhDHMaEiz2VQqlVKtVrMNzMMWYEBh5xcClvV6/Tdlvx1MkCKR8UajYY9Gq9UyMIRPqrB3QNcwgBAI1MELyqAX3m+EF5zN/nj4tx9CA8mIZob/fZaiBkuUUSgUTBl4pVJRIpHQD9CCzg1WqwTwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;polymorphic.png&quot;
        title=&quot;polymorphic.png&quot;
        src=&quot;/static/a99ebb7855eee46e02e449256eb4b2af/55811/polymorphic.png&quot;
        srcset=&quot;/static/a99ebb7855eee46e02e449256eb4b2af/12f09/polymorphic.png 148w,
/static/a99ebb7855eee46e02e449256eb4b2af/e4a3f/polymorphic.png 295w,
/static/a99ebb7855eee46e02e449256eb4b2af/55811/polymorphic.png 501w&quot;
        sizes=&quot;(max-width: 501px) 100vw, 501px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Martin describes this as a “plugin architecture”:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This inversion allows the called module to act like a plugin. Indeed, this is how all plugins work…
Plugin architectures are very robust because stable high value business rules can be kept from depending upon volatile low value modules such as user interfaces and databases.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;With the new setup, the polymorphic cache stores can be swapped for each other without changing the code in &lt;code class=&quot;language-text&quot;&gt;example_method&lt;/code&gt;. New kinds of cache stores can also be supported by creating classes that implement  &lt;code class=&quot;language-text&quot;&gt;#fetch&lt;/code&gt; and other methods as specified by &lt;a href=&quot;https://guides.rubyonrails.org/caching_with_rails.html#activesupport-cache-store&quot;&gt;ActiveSupport::Cache::Store&lt;/a&gt;. &lt;/p&gt;
&lt;p&gt;In short, polymorphism makes it easier to extend or change aspects of our programs, without a rippling of changes throughout the entire program. (On determining these
“aspects”, a good read would be &lt;a href=&quot;https://www.wasabigeek.com/blog/what-does-a-1972-paper-have-to-do-with-the-single-responsibility-principle/&quot;&gt;Parnas’ classic 1972 paper&lt;/a&gt;.)&lt;/p&gt;
&lt;h2&gt;Afterword&lt;/h2&gt;
&lt;p&gt;Note that polymorphism means other things outside the context of OOP (see &lt;a href=&quot;https://en.m.wikipedia.org/wiki/Polymorphism_(computer_science)&quot;&gt;Wikipedia&lt;/a&gt;). The definition we used aligns quite closely to “duck-typing”.&lt;/p&gt;
&lt;p&gt;There are many other neat examples relating to polymorphism. Here’s some I thought of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Martin Fowler’s &lt;a href=&quot;https://martinfowler.com/books/refactoring.html&quot;&gt;refactoring&lt;/a&gt; book has a “Replace Conditional with Polymorphism” refactoring, which I think was neatly illustrated in this &lt;a href=&quot;https://youtu.be/8bZh5LMaSmE&quot;&gt;Sandi Metz talk&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Many &lt;a href=&quot;https://refactoring.guru/design-patterns/behavioral-patterns&quot;&gt;Behavioural Design Patterns&lt;/a&gt; rely on polymorphism, for example the Strategy, Command, Visitor etc.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&quot;https://refactoring.guru/introduce-null-object&quot;&gt;NullObject&lt;/a&gt; is a neat way to support no-ops when your code relies on a Polymorphic interface.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For more musings on software design (with a Ruby/Rails slant), follow me on Twitter:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;“…the thing that truly differentiates OO programs from non-OO programs is polymorphism.”&lt;br&gt;- &lt;a href=&quot;https://twitter.com/unclebobmartin?ref_src=twsrc%5Etfw&quot;&gt;@unclebobmartin&lt;/a&gt;&lt;a href=&quot;https://t.co/PTmFdySst7&quot;&gt;https://t.co/PTmFdySst7&lt;/a&gt;&lt;/p&gt;&amp;mdash; Nick (@wasabigeek) &lt;a href=&quot;https://twitter.com/wasabigeek/status/1505554975404949505?ref_src=twsrc%5Etfw&quot;&gt;March 20, 2022&lt;/a&gt;&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[A 1972 paper and the Single Responsibility Principle]]></title><description><![CDATA[”A class should only have one reason to change” is a mantra that Object-Oriented advocates have chanted for years. Dubbed the “Single…]]></description><link>https://www.wasabigeek.com/blog/what-does-a-1972-paper-have-to-do-with-the-single-responsibility-principle/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/what-does-a-1972-paper-have-to-do-with-the-single-responsibility-principle/</guid><pubDate>Mon, 28 Feb 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;”&lt;em&gt;A class should only have one reason to change&lt;/em&gt;” is a mantra that Object-Oriented advocates have chanted for years. Dubbed the “Single Responsibility Principle” (SRP), it remains somewhat abstract till this day ✨. Abstract enough, in fact, that it’s originator (Robert Martin) felt it worthwhile to explain again in a &lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2014/05/08/SingleReponsibilityPrinciple.html&quot;&gt;blog post&lt;/a&gt; - 14 years after he first wrote about it!&lt;/p&gt;
&lt;p&gt;That blog post begins by referencing and quoting a 1972 paper, ”&lt;strong&gt;On the Criteria To Be Used in Decomposing Systems into Modules&lt;/strong&gt;” by David Parnas:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“We have tried to demonstrate by these examples that it is almost always incorrect to begin the decomposition of a system into modules on the basis of a flowchart. &lt;/p&gt;
&lt;p&gt;We propose instead that one begins with a list of difficult design decisions or design decisions &lt;em&gt;which are likely to change&lt;/em&gt;. Each module is then designed to hide such a decision from the others.”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The paper seemed significant, as Martin wrote that the SRP appeared “to align with Parnas’ formulation”. Could it demystify the SRP? What exactly was this paper about?&lt;/p&gt;
&lt;p&gt;(Note: I’ve tried &lt;em&gt;not&lt;/em&gt; to abstract too much of the paper, in the hope that you’d be able to draw your own conclusions as well.)&lt;/p&gt;
&lt;h2&gt;The System: KWAC Index&lt;/h2&gt;
&lt;p&gt;First, Parnas sets the stage - he would compare two criteria for modularizing a system, showing that one provided superior flexibility. The system in question was a KWAC (KeyWord Alongside Context) index generator.&lt;/p&gt;
&lt;p&gt;KWAC was an indexing system for technical manuals, allowing a reader to quickly find where in the manual a keyword was used. In addition to showing the keyword, KWAC would show the rest of the sentence as well, it’s “context”:
&lt;img src=&quot;https://upload.wikimedia.org/wikipedia/commons/6/61/KWAC.png&quot; alt=&quot;Sample KWAC Index from Wikipedia&quot;&gt;&lt;/p&gt;
&lt;p&gt;To build the KWAC index, the system would take in file of sentences. For example, given the input file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# cat input.txt&lt;/span&gt;
Program Development &lt;span class=&quot;token comment&quot;&gt;# line 1&lt;/span&gt;
On The Criteria &lt;span class=&quot;token comment&quot;&gt;# line 2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For each line, the system looked through every word, generating a KWAC entry. This was done by “circularly shifting” words that came before the keyword, appending them to the end. Then, it would sort the entries alphabetically. For example, given the above file, we’d get:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Criteria. On The &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# &quot;On The Criteria&quot; is the original, &quot;Criteria&quot; was selected as the keyword here&lt;/span&gt;
Development. Program &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
On The Criteria &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
Program Development &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
The Criteria. On &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The next sections explain Parnas’ modularizations. This &lt;a href=&quot;https://youtu.be/R7X4B3-k7g4?t=1036&quot;&gt;video explanation&lt;/a&gt; (starting from 17:16) helped me visualise and understand them, and I’ve borrowed and will continue to borrow liberally from it 🙇‍♂️.&lt;/p&gt;
&lt;h2&gt;Modularization 1: “Flowchart”&lt;/h2&gt;
&lt;p&gt;In the first modularization, Parnas modelled the problem as a flowchart, using the individual steps to break apart the modules (an approach which I’m guilty of applying at face value):&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLUlEQVQoz32S3UtTYRzHz58Q3UQ36k1BQrWKjIiohPRiES0wgiChoJuCBhatFwQTsUuzIoKom0J2oRKCvWCLrVKb21SUZb6Qgc5tbvMldS/nOecTz3nRZdADh9/znOf7+5zvl99RhC4QmsCsKkJX0ax9ai1NfCVBYi1JIpckKetKgoXsgqFXpd7oEaiyR1dRVPugyaoaInSIZ1Mc6KtmW6Cc0g8OSrx7KfXtZ4t/BzWRWkNT0AqGXvZJmGQoJlkYl3K9mung0vBVlnKLvEv48MY6aY914Z3qpD3eRVusg8D8V9B1E6aZIFUrcihf5LW8AWwYa6H8/SHmVmM0TT7k+tBtboTqcYfucPNbPdcGb/F0+rnlULUc2ilVFGFZzgsT+CD6hINvjjOzOsvlaB3OvvO4ei5y+uMFzvpqOdlfw93xRtA2gMKKLF0qYpPD5rHH7Ht7lMVchlB6mE/Jz/jne/HNBQikeo3zSGYU3YosLIf2UNcjFyyHzdFHVHSe4OfvaSqCTrZ376LstYOStj2UeR1s7dlJzWCt6VAvWA7/iSyHYgKbxlrZ3X2YpXyG78sTDKQiRNLDBFNhwukhBtJhJpYnNw1lw6liT8eO3Dr9gqqQi9mVWc4NXuFI0Eml/wzHuk5R+cVFRX8V7lHPX7+NKI5sb+yLnMiSFWssFZZpmmqhbrwez8h9PMEGPNFG3D/u8ezXSwO44U6sQxVR9AUp0HQN3Xr+t1S9CGRVGfkPs68HBSSIJdkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Criteria for Decomposition of Modules 1.png&quot;
        title=&quot;Criteria for Decomposition of Modules 1.png&quot;
        src=&quot;/static/1afa3be2a535182b9280816c458ea9a8/fcda8/Criteria%20for%20Decomposition%20of%20Modules%201.png&quot;
        srcset=&quot;/static/1afa3be2a535182b9280816c458ea9a8/12f09/Criteria%20for%20Decomposition%20of%20Modules%201.png 148w,
/static/1afa3be2a535182b9280816c458ea9a8/e4a3f/Criteria%20for%20Decomposition%20of%20Modules%201.png 295w,
/static/1afa3be2a535182b9280816c458ea9a8/fcda8/Criteria%20for%20Decomposition%20of%20Modules%201.png 590w,
/static/1afa3be2a535182b9280816c458ea9a8/efc66/Criteria%20for%20Decomposition%20of%20Modules%201.png 885w,
/static/1afa3be2a535182b9280816c458ea9a8/c83ae/Criteria%20for%20Decomposition%20of%20Modules%201.png 1180w,
/static/1afa3be2a535182b9280816c458ea9a8/dd507/Criteria%20for%20Decomposition%20of%20Modules%201.png 1528w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;There’s a design flaw that isn’t obvious in the diagram - all the modules rely upon common data stored with a specific layout in memory using low-level operations. I’ll contrast this with Modularization 2 later.&lt;/p&gt;
&lt;p&gt;Here’s what each module did:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Input&lt;/strong&gt; &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Parsed the input text file (see “The System: KWAC Index”) and stores in memory using low-level operations. We’ll call this the in-memory “Characters”.&lt;/li&gt;
&lt;li&gt;There’s a section of the &lt;a href=&quot;https://youtu.be/R7X4B3-k7g4?t=1415&quot;&gt;video (23:36)&lt;/a&gt; that explains this, which if I’ve understood right goes something like: &lt;strong&gt;(1.)&lt;/strong&gt; memory at the time was accessed in groups of 4 characters (bytes), &lt;strong&gt;(2.)&lt;/strong&gt; the input was split across these groups, with spaces in between words and lines.&lt;/li&gt;
&lt;li&gt;We can visualise the stored in-memory “Characters” as follows (Note that line breaks are not distinguished from spaces, that’s tracked separately):
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12.837837837837837%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI1z3PWQ4CQQgE0Ln/PXWm9+mV3rQMaPwieRQQDuoNpWa83hsx3Vh7ovWGVNLf5h5oVJF/drOtgUoVqURsthgw98TBA84ZrDVwqRPUSZraKIzZxfr4mrFaDj7PB/ok+NvDOCM5NhqEw3krC/m6tRoxR7D54BBigDIKuSZZ6IJFbQWXvqS6X4ZntNXy1Qe+8OYMejNJWwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Criteria for Modularization - Approach 1 Input Storage.png&quot;
        title=&quot;Criteria for Modularization - Approach 1 Input Storage.png&quot;
        src=&quot;/static/d8bd433f4cb51feb4e5a1fab55bbb828/fcda8/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png&quot;
        srcset=&quot;/static/d8bd433f4cb51feb4e5a1fab55bbb828/12f09/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png 148w,
/static/d8bd433f4cb51feb4e5a1fab55bbb828/e4a3f/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png 295w,
/static/d8bd433f4cb51feb4e5a1fab55bbb828/fcda8/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png 590w,
/static/d8bd433f4cb51feb4e5a1fab55bbb828/efc66/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png 885w,
/static/d8bd433f4cb51feb4e5a1fab55bbb828/c83ae/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png 1180w,
/static/d8bd433f4cb51feb4e5a1fab55bbb828/fa60d/Criteria%20for%20Modularization%20-%20Approach%201%20Input%20Storage.png 1792w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;The module also outputs “Lines”, which is an array stating the start of each line (e.g. above, Character 1 is the start of line 1, Character 21 is the start of line 2)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Circular Shifter&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Accessing “Characters” and “Lines”, it outputs an array of “Shifts”.&lt;/li&gt;
&lt;li&gt;Each “Shift” stored the line number, as well as the starting index of each word.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Alphabetizer&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Accessing “Characters” and “Shifts”, it sorts the “Shifts” alphabetically and outputs them as “Alphabetized”.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Output&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Accessing “Characters” and “Alphabetized” shifts, outputs the KWAC index (see “The System: KWAC Index”).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A helpful visual summary of all the outputs and stored data from the video explanation:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACX0lEQVQoz3WRS0hUYRiGT16yoMCRpKh1bmrRMhJvac6UiJGZumkXuLSxYmYcRwjbtqhNkJMRVBYUhLQr2xQEugiipdnojDk3z5z7zJzLE+efICH84eHje7/zv3zvf6Smrknq2idp7AoTuBjj6FCC1sEZjgzEaQnFaA5GaO6P1GowSnMwtosoLSGfCIH+CIcv3EFq6Aizr32SQCjKj/UM2eIO6WxBkMkVyMoKuZJKTv6fbKk225YVdMsi+f4LUmNnGOncJC3BKKmtbdIb6/zezpBOb5DeTOG6VWrH2xMPV3zxankVqbFnirruKQIDMTIFGdsuoxkahqmj6SqmaVBSZFRNQdc1FLUk8HtFVVB1lZKqADYvPqwg1ffdor5visDlGFsFmUrFpFDMo6qKMPSNa5dLyKUdofkmuqGhaCXyxTz5YgFwaxse7A3T0HmTY4MRMvkdESGXz2KWTRHF8RxcXGG0sZnCMA2h+0H9JGs/1/i1kRKRFz+uIjX132Z/X4TjQ3PIhgU4qFptA89zcFxb4PemZYiNfd31HKyKhW7q7CjyP8PA6XEOtV3iwMkeFt8uiYG/Tbli4bq2wDe0yqbANxW651CuljEsA0VTxb2X/hu2tpwh2Huens4Ork+ExUC3DCrVCrZjU3WqouriJ2mohiZ6H7NioRk6il4zfP1pBantxBjLX7/z8NkS04k59jxeBdcp49jWLtHF86rYf7V3n78h9Z+a4MGjN8Qj9+gOjTB69znX4vOMxJOC8dkFxmefMpZYYGQ6yXAsydXpJKOJBVGHY/NciT5mbOYJZ2/c5w81UcsnQ6/GvwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Data Structures - On The Criteria for Decomposing Systems - Diego Ongaro.png&quot;
        title=&quot;Data Structures - On The Criteria for Decomposing Systems - Diego Ongaro.png&quot;
        src=&quot;/static/a0b3077f3d649c4e682b3f66972f78c4/fcda8/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png&quot;
        srcset=&quot;/static/a0b3077f3d649c4e682b3f66972f78c4/12f09/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png 148w,
/static/a0b3077f3d649c4e682b3f66972f78c4/e4a3f/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png 295w,
/static/a0b3077f3d649c4e682b3f66972f78c4/fcda8/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png 590w,
/static/a0b3077f3d649c4e682b3f66972f78c4/efc66/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png 885w,
/static/a0b3077f3d649c4e682b3f66972f78c4/c83ae/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png 1180w,
/static/a0b3077f3d649c4e682b3f66972f78c4/97755/Data%20Structures%20-%20On%20The%20Criteria%20for%20Decomposing%20Systems%20-%20Diego%20Ongaro.png 2536w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Modularization 2: “Information Hiding”&lt;/h2&gt;
&lt;p&gt;In this modularization, Parnas uses the criteria of “Information Hiding”. The definition is worth mentioning for it’s relevance to the SRP:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Every module in the second decomposition is characterized by its knowledge of a design decision which it hides from all others. Its interface or definition was chosen to reveal as little as possible about its inner workings.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRklEQVQoz42S30uTYRTHdyvrogi6ylp132UIkndKNDfZ1HSsNYV5UyuI/HHhRRTRTX9E+B8E/bBInTq36abzZ+m2CEVBk9z25vR99/54PvG+mxZZ0AOHc57zcD7P4XuOTTc0DKEDBoomk5W+kJWyZH/kyO7nLL9WzLCxv4EQOprQ0IyTpgrV8jYTJquHJo+lYoaajw5qxmqxv7qAfaiWU8MObCPnqIs1osglEFTsz2OAEAKb+di79pTez4OoukosnyRWTBIrpIjtpYhLKaKFaRalZTRFJbwySGOiFfe4n+aIj+YRH86YD1faT6a4hs2EO2MB3BO3+K7kubsywL25PsKJfsLJfu7HB+iZe8izzAvKssyjzBNuznTQGgniGQvgfR/AOxWkfambnJStANsmQ/hGgmzK29QnXVyfcNIw7KT+3Q0a3jZzbbKJ8Gof/3MqwEQPnoivkvlNH6EZlUAT5KSvpAuLzBYWmM3PW5bKp1nILyFrh6hGdSgWcCKEZ7jTqi3rCoqhUNbLlJQSQhisS1tcidZhf32esy8vc3rIwZmhS9jfXMQxfpVd+VvlX0OtAuMhPKOdJ/vXBJgbpcO8tMzo7iSR7ShjO1EiO1HrPrWXQNFlDGGgH3XoTYfoSN9h52AX71w33nSQtngX7vc+Wqe7rAk+Xn3+T93M1TNhutDNPTRYP9hkR95mvbSFK30b14If95Sflg9+WmYCNKXbefCpn3JVK1MO1fhlRzDNBJpCHg9BGH9f3GrOKqoW60I7Blmx5XV+AorZ6g87A8PsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Criteria for Decomposing Modules 2.png&quot;
        title=&quot;Criteria for Decomposing Modules 2.png&quot;
        src=&quot;/static/5ec2630668bb8897c5864246f64495fe/fcda8/Criteria%20for%20Decomposing%20Modules%202.png&quot;
        srcset=&quot;/static/5ec2630668bb8897c5864246f64495fe/12f09/Criteria%20for%20Decomposing%20Modules%202.png 148w,
/static/5ec2630668bb8897c5864246f64495fe/e4a3f/Criteria%20for%20Decomposing%20Modules%202.png 295w,
/static/5ec2630668bb8897c5864246f64495fe/fcda8/Criteria%20for%20Decomposing%20Modules%202.png 590w,
/static/5ec2630668bb8897c5864246f64495fe/efc66/Criteria%20for%20Decomposing%20Modules%202.png 885w,
/static/5ec2630668bb8897c5864246f64495fe/c83ae/Criteria%20for%20Decomposing%20Modules%202.png 1180w,
/static/5ec2630668bb8897c5864246f64495fe/85e74/Criteria%20for%20Decomposing%20Modules%202.png 1436w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;
Interestingly, what one might typically think as the general “responsibility” remains the same - modules are still mostly split along the same functionality lines. Instead, the major differences that I noticed in this modularization were:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The details of how the characters were stored were encapsulated (hidden) via a new module, “Line Storage”. This meant that other modules did not have to know the low-level layout of the data. Instead, they would have a simpler interface to store and retrieve characters.&lt;/li&gt;
&lt;li&gt;The dependencies of modules were also tweaked, such that only two modules interact directly with “Line Storage”, as opposed to every module having to access “Characters” in Modularization 1.&lt;/li&gt;
&lt;li&gt;Modules in Modularization 1 depended on outputs from previous modules or common in-memory data. In contrast, modules in Modularization 2 depended directly on the interface of other modules (similar to calling methods on the module, a more Object-Oriented style).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each module in greater detail:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Input&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Like Modularization 1, also parses the input file, but this time initializes a “Line Storage” and inserts the data.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Line Storage&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Think of it like an Object that has methods for inserting and retrieving characters by line (e.g. get Character 5 of Line 1, Word 2).&lt;/li&gt;
&lt;li&gt;Note: Unlike Modularization 1, this means callers do not need to know the nitty-gritty details of how data is stored.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Circular Shifter&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Generates the circular shifts from Line Storage in an initialization step.&lt;/li&gt;
&lt;li&gt;Instead of outputting “Shifts”, the module itself provides an interface (like an Object) similar to Line Storage, but allows retrieval of characters by their &lt;em&gt;shifts&lt;/em&gt; instead of lines (e.g. get Character 5 of &lt;em&gt;Shift&lt;/em&gt; 1, Word 2).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Alphabetizer&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Retrieving the characters from Circular Shifter, this modules sorts by alphabet and remembers the shifts in an initialization step.&lt;/li&gt;
&lt;li&gt;Instead of outputting the “Alphabetized” shifts, the module also provides an interface for getting ordered Circular Shifts indexes (e.g. tell me the shift number that’s in the 2nd sorted position).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Output&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Uses Alphabetizer and Circular Shifter to generate the KWAC Index.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Comparison: Changeability&lt;/h2&gt;
&lt;p&gt;While other comparisons were made, the analysis of changeability speaks most to the SRP. Parnas begins by suggesting some “likely” change scenarios. Most require many modules to be updated in Modularization 1, but have a much smaller blast radius in Modularization 2.&lt;/p&gt;
&lt;p&gt;Let’s take Scenario B below as an example - since all the modules in Modularization 1 depended upon a specific layout of “Characters” in memory, changing that layout would require changing every module. However, in Modularization 2, this would only require a change in the implementation of “Line Storage” - the interface could stay the same, meaning other modules were shielded from this change!&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Scenario&lt;/th&gt;
&lt;th&gt;Modularization 1&lt;/th&gt;
&lt;th&gt;Modularization 2&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;A. Deciding to store “Characters” in a different medium (e.g. filesystem) instead of memory&lt;/td&gt;
&lt;td&gt;All modules&lt;/td&gt;
&lt;td&gt;Line Storage&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;B. Deciding on a different way to store the “Characters” (e.g. group by words instead of every 4 characters)&lt;/td&gt;
&lt;td&gt;All Modules&lt;/td&gt;
&lt;td&gt;Line Storage&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C. Deciding to store the full sentences of each circular shift instead of their indexes&lt;/td&gt;
&lt;td&gt;Circular Shifter, Alphabetizer, Output&lt;/td&gt;
&lt;td&gt;Circular Shifter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;D. Deciding to change “Alphabetized” generation to be lazy or distributed (possibly due to a large dataset?)&lt;/td&gt;
&lt;td&gt;Difficult to achieve as computation must be completed before output&lt;/td&gt;
&lt;td&gt;Achievable as Output doesn’t need all the shifts to be “alphabetized”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;So the takeaway here is that good “information hiding” (a.k.a the SRP) results in a system that adapts more easily to changes. &lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So where does the paper leave us in relation to the SRP? Personally, I left with a better understanding of &lt;em&gt;why&lt;/em&gt; it was important - it should result in a system that is easier to evolve with changes in requirements. However, even with the (helpful) example, we don’t get a magic formula for applying the SRP - it remains more art than science.&lt;/p&gt;
&lt;p&gt;What’s your framework for beginning “with a list of difficult design decisions or design decisions which are likely to change”?&lt;/p&gt;
&lt;p&gt;Discuss on &lt;a href=&quot;https://news.ycombinator.com/item?id=30529854&quot;&gt;Hackernews&lt;/a&gt;, or continue the conversation on &lt;a href=&quot;https://t.co/jKyUJIpnsR&quot;&gt;Twitter&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Tried to get a better intuition for the Single Responsibility Principle and was led to a classic 1972 paper by David Parnas. A good read! &lt;a href=&quot;https://t.co/jKyUJIpnsR&quot;&gt;https://t.co/jKyUJIpnsR&lt;/a&gt;&lt;/p&gt;&amp;mdash; @wasabigeek &lt;a href=&quot;https://twitter.com/wasabigeek/status/1500047320443850753?ref_src=twsrc%5Etfw&quot;&gt;March 5, 2022&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;(I apologise for the mix of American and British english 😆.)&lt;/p&gt;
&lt;h2&gt;Further Reading:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Diego Ontaro’s &lt;a href=&quot;https://youtu.be/R7X4B3-k7g4?t=1036&quot;&gt;talk&lt;/a&gt; and his example &lt;a href=&quot;https://github.com/ongardie/kwic&quot;&gt;code&lt;/a&gt; in Go.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Key_Word_in_Context&quot;&gt;KWIC Indexes in Wikipedia&lt;/a&gt; - note that the original paper calls it a KWIC index, but as Diego Ontaro explains, it’s actually a KWAC index.&lt;/li&gt;
&lt;li&gt;Parnas’ Original Papers: &lt;a href=&quot;https://www.win.tue.nl/~wstomv/edu/2ip30/references/criteria_for_modularization.pdf&quot;&gt;1972&lt;/a&gt; (which references an earlier paper written in &lt;a href=&quot;https://prl.ccs.neu.edu/img/p-tr-1971.pdf&quot;&gt;1971&lt;/a&gt; with more implementation details).&lt;/li&gt;
&lt;li&gt;Adrian Colyer’s elegant and higher-level &lt;a href=&quot;https://blog.acolyer.org/2016/09/05/on-the-criteria-to-be-used-in-decomposing-systems-into-modules/&quot;&gt;summary&lt;/a&gt; of the same paper.&lt;/li&gt;
&lt;li&gt;The paper does make a few other comparisons and points, I’ve left them out to keep this more focused to the SRP. A summary of what’s missing can be found in this &lt;a href=&quot;https://gist.github.com/wasabigeek/08a09190a90ac4463660debce778ef31&quot;&gt;gist&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Reading a Ruby gem with VSCode]]></title><description><![CDATA[Whether out of curiosity or trying to understand a method for debugging, it’s helpful to know how to dig into a Ruby gem. Recently I was…]]></description><link>https://www.wasabigeek.com/blog/reading-a-ruby-gem-with-vscode/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/reading-a-ruby-gem-with-vscode/</guid><pubDate>Tue, 15 Feb 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Whether out of curiosity or trying to understand a method for debugging, it’s helpful to know how to dig into a Ruby gem. Recently I was curious over how &lt;a href=&quot;https://github.com/freerange/mocha/&quot;&gt;mocha&lt;/a&gt;, a mocking library for minitest, allowed stubbing on &lt;code class=&quot;language-text&quot;&gt;any_instance&lt;/code&gt; of a Class (as opposed to injecting a stubbed object), for example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;test_stubbing_an_instance_method_on_all_instances_of_a_class&lt;/span&gt;&lt;/span&gt;
  Product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;any_instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stubs&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;returns&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;stubbed_name&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  product &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Product&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
  assert_equal &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;stubbed_name&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Following this are steps you can try when investigating a gem. I’d love to say these were the exact steps I took while investigating &lt;code class=&quot;language-text&quot;&gt;any_instance&lt;/code&gt;, but truth is some steps I discovered only while writing this post 😅. The steps are specific to using VSCode.&lt;/p&gt;
&lt;h2&gt;Open the Source Code&lt;/h2&gt;
&lt;p&gt;Assuming the gem is installed, &lt;code class=&quot;language-text&quot;&gt;gem open &amp;lt;gemname&gt;&lt;/code&gt; (or &lt;code class=&quot;language-text&quot;&gt;bundle open &amp;lt;gemname&gt;&lt;/code&gt; if installed in a project via Bundler) will open it’s source code with the command set in the &lt;code class=&quot;language-text&quot;&gt;$EDITOR&lt;/code&gt; environment variable.&lt;/p&gt;
&lt;p&gt;For example &lt;code class=&quot;language-text&quot;&gt;EDITOR=code bundle open mocha&lt;/code&gt; from my project opens the gem in VSCode:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c55ef4a8be41a2d8f8603a57ddde1b4d/69d6b/Mocha%20opened%20in%20VSCode.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABO0lEQVQY01XQyY6bQABFUf6jxWCDoZgxRc2Am8StTOpONvn/T7lRnEidLI7eXb9IrgolNbOUzPMfclmw1j5s+45znrCuaG24Xmeu8/y+f1vKBaU0kRwn9CIRl4JWVA/FpWSWC10/UJUlbS1ohKAW4tFD29D/o20apnFk6HuiIdxZjm8krSLrDdlgSU4Flagx4WB1jmdnuDnLai1H8NxC4L5vfNw2XoLldbe83Sxq6IjK/Y32/pNzeKXYvpNvP3g6V9T5iS+r4VMwfA6GF2/4ujkO7/FuRdkd4zacWzFK80FfEUVOdO07ji2g54lOVNSXnDSJKcsK7zeM8Xi/Y7RFLQr9+1+laWdHIwOd3qll4FyUJHFMNE4z++2ZrhvIi/Ihy1JOF0E+BfLRkpYdT0n2nzjNiJP0XZyQJAm/AGzdu+jH1p5NAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Mocha opened in VSCode.png&quot;
        title=&quot;Mocha opened in VSCode.png&quot;
        src=&quot;/static/c55ef4a8be41a2d8f8603a57ddde1b4d/fcda8/Mocha%20opened%20in%20VSCode.png&quot;
        srcset=&quot;/static/c55ef4a8be41a2d8f8603a57ddde1b4d/12f09/Mocha%20opened%20in%20VSCode.png 148w,
/static/c55ef4a8be41a2d8f8603a57ddde1b4d/e4a3f/Mocha%20opened%20in%20VSCode.png 295w,
/static/c55ef4a8be41a2d8f8603a57ddde1b4d/fcda8/Mocha%20opened%20in%20VSCode.png 590w,
/static/c55ef4a8be41a2d8f8603a57ddde1b4d/efc66/Mocha%20opened%20in%20VSCode.png 885w,
/static/c55ef4a8be41a2d8f8603a57ddde1b4d/c83ae/Mocha%20opened%20in%20VSCode.png 1180w,
/static/c55ef4a8be41a2d8f8603a57ddde1b4d/69d6b/Mocha%20opened%20in%20VSCode.png 1912w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If the gem isn’t installed, you could also look up the source code online (&lt;a href=&quot;https://rubygems.org/&quot;&gt;rubygems.org&lt;/a&gt;) and if the code is on GitHub, there’s a handy &lt;a href=&quot;https://twitter.com/github/status/1425505817827151872?s=21&quot;&gt;shortcut&lt;/a&gt; to open it in a browser version of VSCode.&lt;/p&gt;
&lt;h2&gt;Find your Target&lt;/h2&gt;
&lt;p&gt;One of the easiest ways to find the method definition is to use &lt;code class=&quot;language-text&quot;&gt;#source_location&lt;/code&gt;. Fire up an irb console:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;minitest&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mocha/minitest&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:any_instance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source_location
&lt;span class=&quot;token comment&quot;&gt;# =&gt; [&quot;/.../ruby/3.0.3/gems/mocha-1.13.0/lib/mocha/class_methods.rb&quot;, 45]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In case that doesn’t work, since we have the source code open, we can make use of VSCode’s search:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/486ed4d7639cc618d193928c541391cc/dcb79/Searching%20Mocha%20in%20VSCode.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.97297297297297%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADE0lEQVQ4y12TSW/kVBRG/ReQaHWnBttvsv3sqvJcLtcYOiGJkjSNUFogYBEl6gVEDK2OhNJCwBrW/N6D7EoEYvHp3rt4d3zHmc/nzGYpaZoRhiHWxmRpRlXVzLKCej5n2bZMk4RZEJDnOVVVEUURWhuMCQiCsFfnO9vtlrquOT05oVmumOQ5kbXYsuGFDHg+OODZwQFi5JIWKUWRobVGStk3oJTqbV9AGZymaairmvXukMt6zuui5KfbW/66v+f3uzse3r7ll5sb/nj3ns3uE6QJGY/HjIYjRqNHDYcMH2OnLEvKsmKz3XG4aFmVNT/e3PLnw298+OEd99fXvL++5tfv7livFmijSNIZSkl830dIgS8kQvh4novT7WiaTKiLkrwoSKsFelLhhRMORmNeDAZ89OxjRp7CpgVxmjFJp8SJxdoAG4cYG2NtiJQezrxpSCLLumk53Sy42NSU6ZQknqC0Yey6KNntKWEsNK6v8FSEKzTD4XA/+pMdjXG6g8xsxK5t2Ww2nO9aXq5LNk3J8bLh4uiIMAiQ2kcagVDdmF4f730foffWlz5O0y4x+Yrlp684Prvgy4szfj4957OXF3z/9bf8/fCBIs/QiSCcGIxVqC6x9lGh7ItILVCB6H1nsdrgLy85+eIb3ry54vj8iqujz9ldfkVYrng+GPSVo9T0j1zpMxY+vvD+7fix+y6x07YtaRTyettwuWtYtgvKuuJkWVBPI0R3QSkIEk2cBbSZZlVogkgiH7vqCnXyfA9n0VEQJxyudyw3O7brNet5yemyZJ4mCCH6LyEDHx35xIkkKwKCWPV79KWH67q9uv/p7DGyPW55lnNYzdhVU7K8IAgtxpiehrzKWB1tyOc5KpIoq5GBQiiB63p43l5Ox6YJOoR0z6Z6lNGmx0sbgxSCNJ+zOntFtl5jE0sxtcysYRqHJKEhMpo4NF3Cogf7CfT/qkvYjdxVTiczsiwlnqXUacxRZSmSkDiJUGI/tt+R0nX4/4RPvpSqH7k7zCIvWOUxMxswVoqh0Xja4CvN2B33++t2+A+czczXgABk5AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Searching Mocha in VSCode.png&quot;
        title=&quot;Searching Mocha in VSCode.png&quot;
        src=&quot;/static/486ed4d7639cc618d193928c541391cc/fcda8/Searching%20Mocha%20in%20VSCode.png&quot;
        srcset=&quot;/static/486ed4d7639cc618d193928c541391cc/12f09/Searching%20Mocha%20in%20VSCode.png 148w,
/static/486ed4d7639cc618d193928c541391cc/e4a3f/Searching%20Mocha%20in%20VSCode.png 295w,
/static/486ed4d7639cc618d193928c541391cc/fcda8/Searching%20Mocha%20in%20VSCode.png 590w,
/static/486ed4d7639cc618d193928c541391cc/efc66/Searching%20Mocha%20in%20VSCode.png 885w,
/static/486ed4d7639cc618d193928c541391cc/c83ae/Searching%20Mocha%20in%20VSCode.png 1180w,
/static/486ed4d7639cc618d193928c541391cc/dcb79/Searching%20Mocha%20in%20VSCode.png 1700w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Some ideas to try if the results list is really long:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;prefixing the search term with the declaration syntax (e.g. &lt;code class=&quot;language-text&quot;&gt;class &amp;lt;ClassName&gt;&lt;/code&gt; for a class, &lt;code class=&quot;language-text&quot;&gt;def &amp;lt;method_name&gt;&lt;/code&gt; for an instance method) generally works well, but not always, given the many ways to metaprogram in Ruby. For example, it’s not obvious that &lt;code class=&quot;language-text&quot;&gt;any_instance&lt;/code&gt; would have been defined as an instance method.&lt;/li&gt;
&lt;li&gt;”&lt;strong&gt;Match Whole Word&lt;/strong&gt;” (ab) helps exclude classes / methods with the search term as a substring (e.g. it would have excluded &lt;code class=&quot;language-text&quot;&gt;any_instance_method&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;mock_impersonating_any_instance_of&lt;/code&gt; in the results above)&lt;/li&gt;
&lt;li&gt;”&lt;strong&gt;files to include&lt;/strong&gt;” knowing the structure of most gems (see later section), we can usually restrict to the &lt;code class=&quot;language-text&quot;&gt;lib/&lt;/code&gt; directory, which will exclude test files, bin scripts etc&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Trace the Callers&lt;/h2&gt;
&lt;p&gt;While we found the method, it didn’t answer our initial question, which was how &lt;code class=&quot;language-text&quot;&gt;any_instance&lt;/code&gt; becomes callable on any class. We could probably try a “top-down” or “bottom-up” search here.&lt;/p&gt;
&lt;p&gt;For &lt;strong&gt;“bottom-up” search&lt;/strong&gt;, since this is plain Ruby as opposed to Rails, we could try to follow the &lt;code class=&quot;language-text&quot;&gt;require&lt;/code&gt; trail. But if we have an extension like &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=castwide.solargraph&quot;&gt;solargraph&lt;/a&gt;, a simpler way is to make use of VSCode’s &lt;strong&gt;Go to References&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/034c60797b097c8776c230f2742c0a7b/bb543/VSCode%20Go%20To%20References%20in%20Mocha.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJElEQVQoz5WRS2/TQBRG3TQJr5bSAkWCxDPjebg4TuLYsZM0jpO2VG3oA9QdLPj//+Igu9AFOxZH82mu7tG9M54vBKF1JMkYl8UETiFlDxmIJistG+qsXUBgFDoMUEahjHyq19mFDk/4PkL4DKKQwThmMJsSTVOkkgjRR0ofUSP6+H6PXu8jvughZb+5+0tds9bgneTnJOWWvLpnWN4xqm4Yrb7isjN0UhEkK1y6xk0vGJW3pJtvxMtbRHKGP1qjkg1yvEGMNwxmF3hdM2d/eM7r/J73cUUwqRDJmuN4xdtBycHnJa2g4MPkgtXtDy4efnHz8JOz6++MV1vc/Ipwcc3J4orpZovniZRnesZ+uOL5YEnX5uzKlF2Z0Qky2jLD66ccqph8mrGuKu7Ol9yfLyjnOS48wTmHC0PSLKuFdWPO69GcvfSU7nBBJ5rzMp7xajjjRVTQ0jlvVMwojpkVBV8WGZeLlGwUo43FGovRljge4u3IKV2dcxiVRGXB9X3KZpux7ya0REpHpbRkxrsgxmqNCjRCPRJog7WuQWtDFA3wdlX+KPxc4ucVqir5VJzyzBZ4/oQdkVJvcRTEhNY2ze4PdTbGPp316l5HF3RNQTcoeD/Zcrz8xvHihrfZJQfxqnk/z59yqIaN0Bj3NJX9R1pP6XXNjK5+FO6FJW1TsBPMaOs5HTOnpfJmwv8TmqL5mKNojVpeIco7DpJL2mZBx87/S/gbAipCPNfy7t8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;VSCode Go To References in Mocha.png&quot;
        title=&quot;VSCode Go To References in Mocha.png&quot;
        src=&quot;/static/034c60797b097c8776c230f2742c0a7b/fcda8/VSCode%20Go%20To%20References%20in%20Mocha.png&quot;
        srcset=&quot;/static/034c60797b097c8776c230f2742c0a7b/12f09/VSCode%20Go%20To%20References%20in%20Mocha.png 148w,
/static/034c60797b097c8776c230f2742c0a7b/e4a3f/VSCode%20Go%20To%20References%20in%20Mocha.png 295w,
/static/034c60797b097c8776c230f2742c0a7b/fcda8/VSCode%20Go%20To%20References%20in%20Mocha.png 590w,
/static/034c60797b097c8776c230f2742c0a7b/efc66/VSCode%20Go%20To%20References%20in%20Mocha.png 885w,
/static/034c60797b097c8776c230f2742c0a7b/c83ae/VSCode%20Go%20To%20References%20in%20Mocha.png 1180w,
/static/034c60797b097c8776c230f2742c0a7b/bb543/VSCode%20Go%20To%20References%20in%20Mocha.png 1418w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Above, we find that &lt;code class=&quot;language-text&quot;&gt;Mocha::ClassMethods&lt;/code&gt; is included into Class in &lt;code class=&quot;language-text&quot;&gt;Mocha::API&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;send&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:include&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ClassMethods&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can continue doing the same approach, but at some point the “search tree” got quite unwieldy so I switched to a more &lt;strong&gt;“top-down” approach&lt;/strong&gt;, checking the README to see how the gem was &lt;code class=&quot;language-text&quot;&gt;require&lt;/code&gt;-d.&lt;/p&gt;
&lt;h2&gt;Know the Structure of a Gem&lt;/h2&gt;
&lt;p&gt;A quick detour on how a gem is structured - &lt;code class=&quot;language-text&quot;&gt;lib/&lt;/code&gt; generally contains the gem’s core logic. There you’ll find a ruby file and a folder corresponding to the name of the gem. For example, in &lt;code class=&quot;language-text&quot;&gt;mocha&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;lib/
└── mocha.rb
└── mocha/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The ruby file (e.g. &lt;code class=&quot;language-text&quot;&gt;lib/mocha.rb&lt;/code&gt;) generally contains most of the gem’s bootstrapping logic, as this is the file loaded when requiring the gem (i.e. &lt;code class=&quot;language-text&quot;&gt;require &apos;mocha&apos;&lt;/code&gt; would load &lt;code class=&quot;language-text&quot;&gt;lib/mocha.rb&lt;/code&gt;). So typically we’d start our “top-down” search here.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;mocha&lt;/code&gt; is slightly different - it supports multiple test libraries, and in the &lt;a href=&quot;https://github.com/freerange/mocha/#minitest-1&quot;&gt;README&lt;/a&gt; we are instructed to require a different file depending on our test library. For example, for &lt;code class=&quot;language-text&quot;&gt;minitest&lt;/code&gt; we’d do:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;minitest/unit&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mocha/minitest&apos;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So in this case we’d start our search from &lt;code class=&quot;language-text&quot;&gt;lib/mocha/minitest.rb&lt;/code&gt;. There on it’s pretty straightforward Ruby, leading us back to &lt;code class=&quot;language-text&quot;&gt;Mocha::API&lt;/code&gt; (albeit with knowledge of how it gets required!).&lt;/p&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.justinweiss.com/articles/how-to-dispel-ruby-magic-and-understand-your-gems&quot;&gt;How to Dispel Ruby Magic and Understand Your Gems (Justin Weiss)&lt;/a&gt; - an inspiration for much of this&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://guides.rubygems.org/what-is-a-gem/&quot;&gt;Structure of a Gem (RubyGems)&lt;/a&gt; - more details on how a gem is structured, along with a quick start so you can build your own gem!&lt;/li&gt;
&lt;li&gt;VSCode docs on &lt;a href=&quot;https://code.visualstudio.com/docs/editor/codebasics#_search-across-files&quot;&gt;searching across files&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Practical Metaprogramming in Ruby: minitest/mock]]></title><description><![CDATA[(repo) is a tiny mocking library (< 250 lines of code, including comments) that’s also a great showcase for how metaprogramming can be used…]]></description><link>https://www.wasabigeek.com/blog/practical-metaprogramming-in-ruby-minitest-mock/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/practical-metaprogramming-in-ruby-minitest-mock/</guid><pubDate>Sat, 22 Jan 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;minitest/mock&lt;/code&gt; (&lt;a href=&quot;https://github.com/seattlerb/minitest/blob/v5.15.0/lib/minitest/mock.rb&quot;&gt;repo&lt;/a&gt;) is a tiny mocking library (&amp;#x3C; 250 lines of code, &lt;em&gt;including&lt;/em&gt; comments) that’s also a great showcase for how metaprogramming can be used in Ruby - let’s take a look! If you’re new-ish to Ruby, I hope this gives you concrete examples of what metaprogramming is possible, and how to do it.&lt;/p&gt;
&lt;h2&gt;What is metaprogramming?&lt;/h2&gt;
&lt;p&gt;In the context of this article, I’m referring to programs and code that are able to do &lt;em&gt;introspection&lt;/em&gt; (inspect themselves e.g. type or properties) and &lt;em&gt;reflection&lt;/em&gt; (modify their behaviour).&lt;/p&gt;
&lt;h2&gt;First example: Set expectations with method_missing&lt;/h2&gt;
&lt;p&gt;The main feature of &lt;code class=&quot;language-text&quot;&gt;minitest/mock&lt;/code&gt; is the &lt;code class=&quot;language-text&quot;&gt;Minitest::Mock&lt;/code&gt; class, which can be used to test that a method is called, for example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;minitest/mock&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClassUnderTest&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@foo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; foo
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# create an instance of Mock and set an expectation&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# that the method `bar` will be called on it&lt;/span&gt;
mock_foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Minitest&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
mock_foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expect&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;example_return_value&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# inject the mock into the Object-Under-Test&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# which essentially calls `mock_foo.bar`&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ClassUnderTest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mock_foo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call &lt;span class=&quot;token comment&quot;&gt;# =&gt; returns &apos;example_return_value&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# check that `bar` was called&lt;/span&gt;
mock_foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;verify&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice that there’s nowhere in the library where the method &lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt; is explicitly defined, yet running the above doesn’t raise a &lt;code class=&quot;language-text&quot;&gt;NoMethodError&lt;/code&gt;. We were able “define” (well, not exactly, but we’ll get to that) a new method &lt;em&gt;after&lt;/em&gt; the mock object was already instantiated, via the &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; call.&lt;/p&gt;
&lt;p&gt;The truth is &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; (&lt;a href=&quot;https://github.com/seattlerb/minitest/blob/v5.15.0/lib/minitest/mock.rb#L81-L92&quot;&gt;source code&lt;/a&gt;) is straightforward Ruby; it saves the expected call to an Array instance variable - no new method gets defined. The real magic happens in &lt;code class=&quot;language-text&quot;&gt;method_missing&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/minitest/mock.rb#L118&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;method_missing&lt;/span&gt;&lt;/span&gt; sym&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;block
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
  expected_call &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;@expected_calls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;sym&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
  expected_args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; retval&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; val_block &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; expected_call&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values_at&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:retval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:block&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
  &lt;span class=&quot;token variable&quot;&gt;@actual_calls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;sym&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:retval&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; retval&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:args&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; zipped_args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;mod&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mod &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; mod &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; a &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If a method is called that doesn’t exist, Ruby will invoke &lt;code class=&quot;language-text&quot;&gt;method_missing&lt;/code&gt; with a few arguments:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the method’s name in symbol form (&lt;code class=&quot;language-text&quot;&gt;sym&lt;/code&gt; in the above example)&lt;/li&gt;
&lt;li&gt;the arguments (&lt;code class=&quot;language-text&quot;&gt;*args&lt;/code&gt; ) and block (&lt;code class=&quot;language-text&quot;&gt;&amp;amp;block&lt;/code&gt;) passed to the non-existent method&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Minitest::Mock&lt;/code&gt; uses this to catch any undefined method that is called, checking it against the saved expectations. This makes it seem like the object has that method defined!&lt;/p&gt;
&lt;h2&gt;Remove inherited methods via undef_method&lt;/h2&gt;
&lt;p&gt;While &lt;code class=&quot;language-text&quot;&gt;Minitest::Mock&lt;/code&gt; doesn’t explicitly define many methods, it does inherit methods from Ruby’s &lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt; class, such as &lt;code class=&quot;language-text&quot;&gt;#nil?&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;What if we want to check that a mock receives a method call, like &lt;code class=&quot;language-text&quot;&gt;#nil?&lt;/code&gt;? Without any intervention, &lt;code class=&quot;language-text&quot;&gt;method_missing&lt;/code&gt; would &lt;em&gt;not&lt;/em&gt; be invoked, since those methods exist! Something like this would happen:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;mock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expects&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:nil?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
mock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# =&gt; false (this is the default for Object!)&lt;/span&gt;
mock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;verify &lt;span class=&quot;token comment&quot;&gt;# raises MockExpectationError, because the original `#nil?` method is called instead of `method_missing`!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So what the library does here is to undefine them when the class is interpreted. &lt;code class=&quot;language-text&quot;&gt;instance_methods&lt;/code&gt; is used to introspect the class for any instance methods, which are removed via &lt;code class=&quot;language-text&quot;&gt;undef_method&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/minitest/mock.rb#L26&lt;/span&gt;
instance_methods&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;m&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
  undef_method m &lt;span class=&quot;token keyword&quot;&gt;unless&lt;/span&gt; overridden_methods&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; m &lt;span class=&quot;token operator&quot;&gt;=~&lt;/span&gt; &lt;span class=&quot;token regex-literal&quot;&gt;&lt;span class=&quot;token regex&quot;&gt;/^__/&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code class=&quot;language-text&quot;&gt;#nil?&lt;/code&gt; now would properly invoke &lt;code class=&quot;language-text&quot;&gt;method_missing&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Redefining Methods with define_method&lt;/h2&gt;
&lt;p&gt;In the code above, we saw that not all &lt;code class=&quot;language-text&quot;&gt;instance_methods&lt;/code&gt; were removed, there are some &lt;code class=&quot;language-text&quot;&gt;overridden_methods&lt;/code&gt; (e.g. &lt;code class=&quot;language-text&quot;&gt;inspect&lt;/code&gt;) where the library opts to keep the default implementation &lt;em&gt;unless&lt;/em&gt; the user has explicitly set an expectation. This is done by re-defining them via &lt;code class=&quot;language-text&quot;&gt;define_method&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/minitest/mock.rb#L30&lt;/span&gt;
overridden_methods&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:to_sym&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;method_id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;define_method&lt;/span&gt; method_id &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;@expected_calls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; method_id &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
      method_missing&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;method_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The goal seems to be so that a &lt;code class=&quot;language-text&quot;&gt;Minitest::Mock&lt;/code&gt; instance still responds like a Ruby object e.g. when printing it in the terminal 😄.&lt;/p&gt;
&lt;h2&gt;Stubbing by redefining methods on “Metaclasses”&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;minitest/mock&lt;/code&gt; also has a stubbing feature, which allows you to redefine the return value of an object within a block:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stub&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;example&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now &lt;span class=&quot;token comment&quot;&gt;# =&gt; &quot;example&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token builtin&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now &lt;span class=&quot;token comment&quot;&gt;# =&gt; actual time...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s look at the implementation - the library first opens the &lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt; class, and defines a &lt;code class=&quot;language-text&quot;&gt;stub&lt;/code&gt; method there:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# lib/minitest/mock.rb#L214&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;stub&lt;/span&gt;&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; val_or_callable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;block_args
    &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since &lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt; is the ancestor of all almost everything in Ruby (including Classes and Modules), we are able to call &lt;code class=&quot;language-text&quot;&gt;stub&lt;/code&gt; on basically anything. The actual implementation of &lt;code class=&quot;language-text&quot;&gt;stub&lt;/code&gt; is the interesting bit, introducing us to Ruby’s “metaclasses” (also known as “singleton classes” or “eigenclasses”):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# lib/minitest/mock.rb#L214&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;stub&lt;/span&gt;&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; val_or_callable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;block_args
    new_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;__minitest_stub__&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

    metaclass &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
    metaclass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;send &lt;span class=&quot;token symbol&quot;&gt;:alias_method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; new_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name

    metaclass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;send &lt;span class=&quot;token symbol&quot;&gt;:define_method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;blk&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# return or execute val_or_callable&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;ensure&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# cleanup...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There’s some further reading on metaclasses and that mysterious &lt;code class=&quot;language-text&quot;&gt;class &amp;lt;&amp;lt; self&lt;/code&gt; syntax in the footnotes, but one way to understand the above is to replace the following lines:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;metaclass &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
metaclass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;send &lt;span class=&quot;token symbol&quot;&gt;:define_method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;blk&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;…with:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;name&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;blk&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In other words, &lt;code class=&quot;language-text&quot;&gt;stub&lt;/code&gt; is defining (or overwriting) the method on the object - the type of method (class/instance) being neatly handled by accessing the metaclass. (Note: &lt;code class=&quot;language-text&quot;&gt;self.define_method&lt;/code&gt; would not work for class methods, since &lt;code class=&quot;language-text&quot;&gt;self&lt;/code&gt; returns the class, it would define instance methods.)&lt;/p&gt;
&lt;p&gt;The original logic is kept safe by renaming it via &lt;code class=&quot;language-text&quot;&gt;alias_method&lt;/code&gt;, and in the &lt;code class=&quot;language-text&quot;&gt;ensure&lt;/code&gt; block, there is code to reverse this change. These ensure stubbing only takes effect in the stub block.&lt;/p&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;p&gt;Note that metaprogramming, while powerful, comes with a performance and readability cost. Use with care!&lt;/p&gt;
&lt;p&gt;For further reading on various topics touched in this article, check these out:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://martinfowler.com/articles/mocksArentStubs.html&quot;&gt;Mocks aren’t Stubs&lt;/a&gt; by Martin Fowler&lt;/li&gt;
&lt;li&gt;Notes on &lt;a href=&quot;https://cs.lmu.edu/~ray/notes/metaprogramming/&quot;&gt;Metaprogramming&lt;/a&gt; by Ray Toal&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ruby metaclasses:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.toptal.com/ruby/ruby-metaprogramming-cooler-than-it-sounds&quot;&gt;Ruby Metaprogramming Is Even Cooler Than It Sounds&lt;/a&gt; by Nikola Todorovic&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@leo_hetsch/demystifying-singleton-classes-in-ruby-caf3fa4c9d91&quot;&gt;Diving into Ruby Singleton Classes&lt;/a&gt; by Léonard Hetsch&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yehudakatz.com/2009/11/15/metaprogramming-in-ruby-its-all-about-the-self/&quot;&gt;Metaprogramming in Ruby: It’s All About the Self&lt;/a&gt; by Yehuda Katz&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Mocking in RSpec VS Minitest: A Cheatsheet]]></title><description><![CDATA[My first exposure to a testing library in Ruby and Rails was RSpec, but I’m now using Minitest. It wasn’t immediately obvious how to…]]></description><link>https://www.wasabigeek.com/blog/mocking-in-rspec-and-minitest-cheatsheat/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/mocking-in-rspec-and-minitest-cheatsheat/</guid><pubDate>Wed, 05 Jan 2022 23:21:03 GMT</pubDate><content:encoded>&lt;p&gt;My first exposure to a testing library in Ruby and Rails was RSpec, but I’m now using Minitest. It wasn’t immediately obvious how to translate rspec-expectations and rspec-mocks to Minitest, so here’s my attempt at a cheatsheet:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;RSpec&lt;/th&gt;
&lt;th&gt;minitest with &lt;a href=&quot;https://github.com/freerange/mocha&quot;&gt;mocha&lt;/a&gt;&lt;/th&gt;
&lt;th&gt;minitest with &lt;a href=&quot;https://github.com/seattlerb/minitest#mocks-&quot;&gt;minitest/mocks&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;double&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;mock&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;stub&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Minitest::Mock.new&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;instance_double&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;stub&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;mock.responds_like_instance_of&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Not supported&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;expect().to receive().with().and_return()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;mock.expects().with().returns()&lt;/code&gt;&lt;br/&gt;Note:&lt;ul&gt;&lt;li&gt;like RSpec, can also call &lt;code class=&quot;language-text&quot;&gt;expects&lt;/code&gt; on any object, not just a &lt;code class=&quot;language-text&quot;&gt;Mock&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;Stub&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;with&lt;/code&gt; has &lt;a href=&quot;https://github.com/freerange/mocha/issues/446#issuecomment-1006680273&quot;&gt;imprecise keyword arg matching&lt;/a&gt; in Ruby 3&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;mock = Minitest::Mock.new&lt;/code&gt;&lt;br/&gt;&lt;code class=&quot;language-text&quot;&gt;mock.expect(:method, args, return)&lt;/code&gt;&lt;br/&gt;&lt;code class=&quot;language-text&quot;&gt;mock.verify&lt;/code&gt;&lt;br/&gt;Note: cannot call &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; on any Object, but can make a Mock &lt;a href=&quot;https://github.com/seattlerb/minitest/blob/v5.15.0/lib/minitest/mock.rb#L120-L121&quot;&gt;delegate to an underlying object&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;expect().not_to receive()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;mock.expects().never&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Technically you could use &lt;a href=&quot;https://github.com/seattlerb/minitest/blob/v5.15.0/lib/minitest/mock.rb#L214&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Object#stub&lt;/code&gt;&lt;/a&gt; and raise in the &lt;code class=&quot;language-text&quot;&gt;val_or_callable&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;expect()... and yield_control()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;mock.expects().yields(*parameters)&lt;/code&gt; &lt;br/&gt;See &lt;a href=&quot;https://www.rubydoc.info/github/floehopper/mocha/Mocha%2FExpectation:yields&quot;&gt;docs&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Not supported since return value is not a callable&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;expect()... and raise_error()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;mock.expects().raises(error)&lt;/code&gt; &lt;br/&gt;See &lt;a href=&quot;https://www.rubydoc.info/github/floehopper/mocha/Mocha%2FExpectation:raises&quot;&gt;docs&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Can pass in a block (instead of expected args) to &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; and raise there&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;allow()...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Similar as above but substitute &lt;code class=&quot;language-text&quot;&gt;expects&lt;/code&gt; with &lt;code class=&quot;language-text&quot;&gt;stubs&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Can use &lt;a href=&quot;https://github.com/seattlerb/minitest/blob/v5.15.0/lib/minitest/mock.rb#L214&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Object#stub&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;.and_call_original&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Not supported (see &lt;a href=&quot;https://github.com/freerange/mocha/issues/334&quot;&gt;reasoning&lt;/a&gt;)&lt;/td&gt;
&lt;td&gt;Not supported&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;allow_any_instance_of.Klass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Klass.any_instance.stubs&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Not supported&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;It’s very possible I’ve gotten something wrong - please feel free to correct in the comments or submit a PR!&lt;/p&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;For the curious, I wrote about how &lt;code class=&quot;language-text&quot;&gt;minitest/mock&lt;/code&gt; works &lt;a href=&quot;https://wasabigeek.com/blog/practical-metaprogramming-in-ruby-minitest-mock/&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[My Learning Workflow for 2022]]></title><description><![CDATA[I’ve been working through a course on Coursera recently, and it’s been a great opportunity to reflect on where I am in the “meta” of…]]></description><link>https://www.wasabigeek.com/blog/my-learning-workflow-for-2022/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/my-learning-workflow-for-2022/</guid><pubDate>Fri, 31 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I’ve been working through a course on Coursera recently, and it’s been a great opportunity to reflect on where I am in the “meta” of learning. This post walk throughs my current workflow before diving into the context behind it.&lt;/p&gt;
&lt;h2&gt;1. The Workflow&lt;/h2&gt;
&lt;p&gt;The workflow is loosely based on Zettelkasten, with a little thrown in from a “Learning to Learn” course I audited last year. I’m currently using two tools: &lt;strong&gt;Obsidian&lt;/strong&gt; for note-taking, and &lt;strong&gt;Anki&lt;/strong&gt; for testing myself / spaced-repetition. More on these in later sections.&lt;/p&gt;
&lt;p&gt;My Obsidian knowledge base is about 6 months old (I’ve yet to migrate my older knowledge base) and looks like this, with a few top level folders:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aa9cafa6bf9fc3f058d98289674c84eb/c4842/ObsidianDirectoryStructure2021.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVQ4y22T2XKbQBBFsfVile2ytoFB7DPsMAKEUOTEWf7/p26qG0lOUnk4dZlp6tIb1tZ5w9tqhcXjIx6vLBYLPDw84OXlBUpppGmGzWaL3XbHbP9htxOwhQ0hbFirtxUcx4EjJdz9nnUnBDabDXw/xOXLB47DGVVpYNoBTd3NNB3apodpe45FoUISZ7CCIGAj6TgIXJfxpYS0bSRJgvP5jMvlgq7vYEwLczBo2wZdd+C7ruvQti3qpub3Lc/zoLRG5EjkUqJyXbR7D5F0odMMp9MJ0zThcDhc6a4cMAwDG95iURTBEkIgTVPsPQ9734cXBFhvtxC2DaUUjDGcQVVVrE3ToK5rhs4UpzuKk49lC4Esy5Aode8j3RH0xbnkd5ymiTOdMz5jHMe73qogtWggWikkvg8tJRJHcnaUeRiGXNY0jSirAmmqkGWaSdNZdaqR5zlDiVm246DQGtp1kUiJWJKhuBuO44Tx+AN9945j/w3T+BPT+At995V1GM5ozVw6lW3Zto0sz7l/m92OV0aIT8MiN8jTnimyI+JY84pE0UwYxvB9n6GN4aHQuGnaZM476Tj8HIUxmuodpvlAU/e8h3VdoSgKlGWJsrzpDJVtvb6+svvz8zOWy+Wdp+UTAj/AcaDF/o6+75EXGYoinympb9fz1Zg+ZK3Xa14PMqUSSelutVrx2ZgGTVvzIteVQZGNKLLhD47QOkcYBvw+95CaeYN2iwK3Hmql+X/WelaVZFBJCqU+NUkU4jhm2JAypL65rstImrQQ3GTaxb8J/0PEZvSn/AbimIa8cuOdOAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ObsidianDirectoryStructure2021.png&quot;
        title=&quot;ObsidianDirectoryStructure2021.png&quot;
        src=&quot;/static/aa9cafa6bf9fc3f058d98289674c84eb/fcda8/ObsidianDirectoryStructure2021.png&quot;
        srcset=&quot;/static/aa9cafa6bf9fc3f058d98289674c84eb/12f09/ObsidianDirectoryStructure2021.png 148w,
/static/aa9cafa6bf9fc3f058d98289674c84eb/e4a3f/ObsidianDirectoryStructure2021.png 295w,
/static/aa9cafa6bf9fc3f058d98289674c84eb/fcda8/ObsidianDirectoryStructure2021.png 590w,
/static/aa9cafa6bf9fc3f058d98289674c84eb/efc66/ObsidianDirectoryStructure2021.png 885w,
/static/aa9cafa6bf9fc3f058d98289674c84eb/c83ae/ObsidianDirectoryStructure2021.png 1180w,
/static/aa9cafa6bf9fc3f058d98289674c84eb/c4842/ObsidianDirectoryStructure2021.png 1634w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Articles&lt;/strong&gt; - where I store my literature notes (explained later). I named it “articles” since it was shorter, which makes it easier to add a note via Obsidian’s quick switcher:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d27c69581be3221624c949cbd556b840/6b95e/ObsidianQuickSwitcherCreateFile.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.027027027027025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVQY02WOa26EMAyEOUNLnISFvAjNQiDdrtT7H20qe5VKVX98GtuyZzxomhBjRkoZ3kcEn5BixjTNUMqAyEKTFf2LEZTSGEcC0YT3txGDMTec5yeez29c10Pq1r6Q1w9obWHNDbzzT+0sOBcRQoJbIkq5YyBSCCGglCKs64rjOLDvO5ZlEZxzot77395aC2OM3OacEeNLh3mepWAjJqUkZrVWtNZwXZfAITzrvEyi7LNyCD80EJEMeGHbNvmCjXtyP7jvuwSd5yl61CohPaw/8gP4qYpt4SNnzQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ObsidianQuickSwitcherCreateFile.png&quot;
        title=&quot;ObsidianQuickSwitcherCreateFile.png&quot;
        src=&quot;/static/d27c69581be3221624c949cbd556b840/fcda8/ObsidianQuickSwitcherCreateFile.png&quot;
        srcset=&quot;/static/d27c69581be3221624c949cbd556b840/12f09/ObsidianQuickSwitcherCreateFile.png 148w,
/static/d27c69581be3221624c949cbd556b840/e4a3f/ObsidianQuickSwitcherCreateFile.png 295w,
/static/d27c69581be3221624c949cbd556b840/fcda8/ObsidianQuickSwitcherCreateFile.png 590w,
/static/d27c69581be3221624c949cbd556b840/efc66/ObsidianQuickSwitcherCreateFile.png 885w,
/static/d27c69581be3221624c949cbd556b840/c83ae/ObsidianQuickSwitcherCreateFile.png 1180w,
/static/d27c69581be3221624c949cbd556b840/6b95e/ObsidianQuickSwitcherCreateFile.png 1458w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Files&lt;/strong&gt; - let me state the obvious that files go here, it just makes my root directory cleaner. I don’t bother with subfolders, relying on the backlinks (connections) to find stuff. There’s a useful setting to automatically add all pasted files to this folder:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/38874544e3fb9c1f337cf46159c3b101/2d86d/ObsidianAttachmentFolderSetting.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 11.486486486486488%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVQI13WMOwpAIQwEPYMk4oeoKOb+N1xJwOIVrxhmi2XCnBN7b6y13GMMMPMvKSXHds4ZvXdHREDECBZSVZxz0FpDKcX9qLV+/IIvan8LxxhBRLhbSzP4Yog+gwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ObsidianAttachmentFolderSetting.png&quot;
        title=&quot;ObsidianAttachmentFolderSetting.png&quot;
        src=&quot;/static/38874544e3fb9c1f337cf46159c3b101/fcda8/ObsidianAttachmentFolderSetting.png&quot;
        srcset=&quot;/static/38874544e3fb9c1f337cf46159c3b101/12f09/ObsidianAttachmentFolderSetting.png 148w,
/static/38874544e3fb9c1f337cf46159c3b101/e4a3f/ObsidianAttachmentFolderSetting.png 295w,
/static/38874544e3fb9c1f337cf46159c3b101/fcda8/ObsidianAttachmentFolderSetting.png 590w,
/static/38874544e3fb9c1f337cf46159c3b101/efc66/ObsidianAttachmentFolderSetting.png 885w,
/static/38874544e3fb9c1f337cf46159c3b101/c83ae/ObsidianAttachmentFolderSetting.png 1180w,
/static/38874544e3fb9c1f337cf46159c3b101/2d86d/ObsidianAttachmentFolderSetting.png 2578w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Blog&lt;/strong&gt; - is where I record ideas for posts and start drawing connections with the rest of the knowledge base. (Fun aside, this post was brewed 🍺 in Obsidian!)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Templates&lt;/strong&gt; and &lt;strong&gt;Daily Notes&lt;/strong&gt; are plugin-related, and mostly for what they say (though I still ended up doing most of my journalling in Notion)&lt;/li&gt;
&lt;li&gt;The rest of the folders are mostly there from earlier experiments, I will move the stuff out of there… &lt;em&gt;someday&lt;/em&gt; 🏃.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;All&lt;/em&gt; other notes (“permanent” notes) go into the root directory, yay!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And the workflow for this course was:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start a literature note in Articles for general note-taking&lt;/li&gt;
&lt;li&gt;While taking literature notes, create placeholder notes (or link to existing notes) for individual concepts that seem useful or I want to go deeper into:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2ba60165a03a5cc5115b844be25c43b/0d0e4/ObsidianLiteratureNoteExample.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVQoz02T2W7aUBCGeYiqNAIbs3jB2zHG2OBDCERJCUsKMYuaXiTc97pSH6Fv/VXnRGlz8WlmNGd+z4zGNdPo4rkRU3lLkV8zTMeaUVaSDSfavsUSu+czTCf6Xd+LqX9uclU3aTbaNK4srJZDLQgCFotbhsMhYRgxGuVMp9eaIi9IkgHj8YSylBTFWOcVQgiknOrcbHZDnhe02x1q/X6f/X7Pw2qlH5WyZLVacTge2Ww2LB8e2O123N3dsd1uOR6PfH9+Zj6fc39/z3q95ump4vX1gud51BzH0Q832y3V4aD99XrD4XCgqg7c3Mz5tttpofP5TFVVHE8nbVUjp9OZWAjq9TqWZVFzXZfHx0cWiwXL5VJ39fXrEiklk8mEPM/Jsow0TfVaRqORRvkKlVcarVbrTVCN/PLywuVyYf+0pzpUupPpVPKlXsdsNml+oNFoaD7GpmlqMSVaM80WhqGCDkbTotm0MIw2bauH1e7wyTQx1NdbLV2git/tf9/4J1rrdLqIeIyIJkRhQZpcI6KSIBozixN+hhHCtmnbNj3H0Yu3XVdbhRrX931s237rUKlmo4y8eNuVlCVFkTPMMm6l5PfshkspOZaSezllEAuSIGAgBEEYos4ujoUWV11qwTAKCcOANB0QxRFxHJEkApEO6AYBaZKwDUMe/IB5r8ePvs+dbXNlGLTUSowPI6tjdJ1Qo/4EhWP7Ou52Xf6Ukl/FmNIPSFwP13F0YduytP2IHlkt3/cKPDfD93JNX/sTAm/ILEkQUYwbBISxII5jXfh+Ju/2nb8Nc3lINlPCLAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ObsidianLiteratureNoteExample.png&quot;
        title=&quot;ObsidianLiteratureNoteExample.png&quot;
        src=&quot;/static/c2ba60165a03a5cc5115b844be25c43b/fcda8/ObsidianLiteratureNoteExample.png&quot;
        srcset=&quot;/static/c2ba60165a03a5cc5115b844be25c43b/12f09/ObsidianLiteratureNoteExample.png 148w,
/static/c2ba60165a03a5cc5115b844be25c43b/e4a3f/ObsidianLiteratureNoteExample.png 295w,
/static/c2ba60165a03a5cc5115b844be25c43b/fcda8/ObsidianLiteratureNoteExample.png 590w,
/static/c2ba60165a03a5cc5115b844be25c43b/efc66/ObsidianLiteratureNoteExample.png 885w,
/static/c2ba60165a03a5cc5115b844be25c43b/c83ae/ObsidianLiteratureNoteExample.png 1180w,
/static/c2ba60165a03a5cc5115b844be25c43b/0d0e4/ObsidianLiteratureNoteExample.png 1230w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;When I want to internalise something (happens often after failing a weekly assignment 😆), I create a question and sync Anki flashcards via this &lt;a href=&quot;https://github.com/debanjandhar12/Obsidian-Anki-Sync&quot;&gt;plugin&lt;/a&gt; (having a bit of issues rendering Latex though):
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVQoz42RSZKFMAxDuQjzPEMI0/0P5l9P/WHVVd0LlZ1YFlII8jy3siytbVvruk61rmuhaRqh73vNhmF4eyqADweNOI4tmOfZxnEUmX6aJp2XZdEZ4aqqBJaozwc5Z1kmIZAkiQUs7vtu27bZvh92nqf64zh0z1JRFFZ8K4kAQoA7OGma/jjEtvfeVudUnXNyhmPEAeLuO7/vW3XzXimYwcF5FEUWEO88L5EYrusqMd6FnjcKw/CN9RsQeiMjeF2X4lGJiyBCuOq6XguQ/4Ii8wY88POHcUbPHbOH+B9BHH4A1TfOGg3B27AAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ObsidianAnkiExample.png&quot;
        title=&quot;ObsidianAnkiExample.png&quot;
        src=&quot;/static/6e582424c5d98fdc34fe53ae98d5d83e/fcda8/ObsidianAnkiExample.png&quot;
        srcset=&quot;/static/6e582424c5d98fdc34fe53ae98d5d83e/12f09/ObsidianAnkiExample.png 148w,
/static/6e582424c5d98fdc34fe53ae98d5d83e/e4a3f/ObsidianAnkiExample.png 295w,
/static/6e582424c5d98fdc34fe53ae98d5d83e/fcda8/ObsidianAnkiExample.png 590w,
/static/6e582424c5d98fdc34fe53ae98d5d83e/efc66/ObsidianAnkiExample.png 885w,
/static/6e582424c5d98fdc34fe53ae98d5d83e/fbf08/ObsidianAnkiExample.png 962w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Occasionally I’ll revise the flashcards, either via the Anki desktop app or the web app on mobile (good enough 🤷‍♂️ there are other options)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;2. The Context&lt;/h2&gt;
&lt;p&gt;Next I’ll go deeper into my influences.&lt;/p&gt;
&lt;h3&gt;Zettelkasten&lt;/h3&gt;
&lt;p&gt;This is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Zettelkasten&quot;&gt;system of note-taking&lt;/a&gt; that is often mentioned together with Niklas Luhmann, who had a massive knowledge base (&lt;a href=&quot;https://en.wikipedia.org/wiki/Niklas_Luhmann#Note-taking_system_(Zettelkasten)&quot;&gt;90,000 index cards&lt;/a&gt;) and credited the system for helping him write prolifically. He wrote more than 70 books and nearly 400 scholarly articles!&lt;/p&gt;
&lt;p&gt;After multiple failed attempts at starting a hierarchical knowledge base, I’ve found this approach &lt;em&gt;freeing&lt;/em&gt;. Previously, I often got stymied by categorisation - what title should I give this note so it’s searchable? Which folder should it go into? Should I be using a tag instead?&lt;/p&gt;
&lt;p&gt;Zettelkasten obviates much of that pain by eschewing hierarchical knowledge bases, favouring small, “atomic” notes with connections between them i.e. think graphs, not folders. When I need to reference something, it’s often easier to find because each note is generally a cohesive topic (“atomic”), and the trail of connections make it possible to find related information or unusual connections. I think this maps a lot closer to the brain - after all, we draw metaphors or parallels from other disciplines, and may find ourselves often having to recategorise information (especially when learning something new).&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3b4b71819c4c1d09454e7c3a197bfc74/11a8f/ObsidianGraphView.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz11S7W6DMAzMU6yIkC9IgHVU69q1U/ch3v+pbnLKRWl/nAz2+ewzqE4bHJZ3/Hz/4Xb7xX5/QNO00NpAtxW0eci1BR06bWGMhzUeypqA1/mAaXyDNT28iwg+PaAPY0GdG/ppi1s+JCitNc7nEy6XT+x2L2jbFs67jJQiYhwyQvBwzm5w8L5C8Lk+DD2UMRan0xnrumaxruvQ9z2GYUBK6SF6L6KEQwghcyUvkHdlrcXx+IHr9QtN02TBGGOGkCQKUQSlWYTkmYMEUidHUf0+3ZUiyfM8l40lCjiwdiIQDSWJuhhTys+06bwvG8lA1qSHUWqyRBEU4jOZQ4Totu3JociyLBjHMeemabpbrkVkAglser4Rc8Kj1bS5kp58Q9rlR6hPwHvyhuRwew7m6YplNlKIYvw16KDelgMkcuN/JXM0DDpMOtoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ObsidianGraphView.png&quot;
        title=&quot;ObsidianGraphView.png&quot;
        src=&quot;/static/3b4b71819c4c1d09454e7c3a197bfc74/fcda8/ObsidianGraphView.png&quot;
        srcset=&quot;/static/3b4b71819c4c1d09454e7c3a197bfc74/12f09/ObsidianGraphView.png 148w,
/static/3b4b71819c4c1d09454e7c3a197bfc74/e4a3f/ObsidianGraphView.png 295w,
/static/3b4b71819c4c1d09454e7c3a197bfc74/fcda8/ObsidianGraphView.png 590w,
/static/3b4b71819c4c1d09454e7c3a197bfc74/efc66/ObsidianGraphView.png 885w,
/static/3b4b71819c4c1d09454e7c3a197bfc74/c83ae/ObsidianGraphView.png 1180w,
/static/3b4b71819c4c1d09454e7c3a197bfc74/11a8f/ObsidianGraphView.png 1272w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;A related workflow I’ve adopted is a “pre-processing” step of first taking “literature notes” before converting to “permanent” notes. I think this is from &lt;a href=&quot;https://takesmartnotes.com/&quot;&gt;How to take Smart Notes&lt;/a&gt;, though I first heard of this while watching a video by &lt;a href=&quot;https://www.youtube.com/watch?v=rOSZOCoqOo8&quot;&gt;Shu Omi&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Resources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Shu Omi has good &lt;a href=&quot;https://www.youtube.com/watch?v=rOSZOCoqOo8&quot;&gt;introduction&lt;/a&gt; videos&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://luhmann.surge.sh/communicating-with-slip-boxes&quot;&gt;Luhmann’s writeup&lt;/a&gt; on Zettelkasten&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Tool of Choice: Obsidian&lt;/h3&gt;
&lt;p&gt;I first attempted to maintain a Zettelkasten knowledge base in &lt;a href=&quot;https://www.notion.com&quot;&gt;Notion&lt;/a&gt;, because:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One-app-to-rule-them-all: I was already using it as a goal setting and project management tool.&lt;/li&gt;
&lt;li&gt;It had a mobile app, web clipper and a pleasant UX.&lt;/li&gt;
&lt;li&gt;You could (tediously) link various pages together, and they later introduced backlinks.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ultimately, I moved over to &lt;a href=&quot;https://obsidian.md/&quot;&gt;Obsidian&lt;/a&gt;, which had less polish but was better in one crucial aspect; it was easier to adopt a Zettelkasten-influenced system:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Building connections between notes was trivial (two square brackets), while it took a few seconds to just to search for or create a new note in Notion.&lt;/li&gt;
&lt;li&gt;Searching for a note was much faster, because it’s local first and there is a keyboard shortcut to search by title (Notion defaults to including page text, which slows down search considerably).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What Obsidian also had going for it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Notes are stored as markdown files; which I thought might be easier to work with if I ever wanted my knowledge base to be public (i.e. a digital garden). My blog also uses markdown files, which made conversion pretty straightforward and automatable.&lt;/li&gt;
&lt;li&gt;has a burgeoning plugin system, in particular I wanted to be able to do spaced repetition (see next section).&lt;/li&gt;
&lt;li&gt;Local-first (fast, private) and E2E encryption if you pay for their sync service.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Other tools I’ve tried:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://roamresearch.com/&quot;&gt;Roam&lt;/a&gt; - arguably one of the first movers in “graph” knowledge bases, but was clunky when I first tried it plus it got expensive.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.remnote.com/&quot;&gt;Remnote&lt;/a&gt; - has built in spaced repetition (see next section) but I found setting up repetition to be a bit unintuitive, and it had no mobile app.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Learning How to Learn (Coursera)&lt;/h3&gt;
&lt;p&gt;This was a &lt;a href=&quot;https://www.coursera.org/learn/learning-how-to-learn&quot;&gt;Coursera course&lt;/a&gt; I audited last year, and while it felt a bit disjointed, I had a lot of useful takeaways, in particular:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;not&lt;/em&gt; actively thinking about a problem can actually help you come up with solutions (diffuse thinking)&lt;/li&gt;
&lt;li&gt;testing yourself + space repetition is &lt;strong&gt;super effective&lt;/strong&gt;, better than blindly re-reading notes etc.&lt;/li&gt;
&lt;li&gt;use memory techniques to help understand and remember: chunking, analogies and metaphors&lt;/li&gt;
&lt;li&gt;exercise and sleep help you think better&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;How I’ve tried to apply this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;learnt to appreciate doing “nothing”, especially when working on a problem requiring creative thinking&lt;/li&gt;
&lt;li&gt;wrote questions and used an Obsidian plugin to sync them to &lt;a href=&quot;https://apps.ankiweb.net/&quot;&gt;Anki&lt;/a&gt; (a spaced repetition tool), so I could test myself with spaced repetition. (The “tried” qualifier is important, as in practice this has required quite a lot of effort and discipline 😊)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Growth Mindset&lt;/h3&gt;
&lt;p&gt;This doesn’t manifest in the workflow or the tools I use, but it’s had a massive influence in my learning journey last year. I had watched short videos on having a growth mindset before, but it was only after reading &lt;a href=&quot;https://play.google.com/store/books/details/Mindset_The_New_Psychology_of_Success?id=fdjqz0TPL2wC&quot;&gt;Carol Dweck’s book&lt;/a&gt; that I started internalising it.&lt;/p&gt;
&lt;p&gt;Self-doubt has been a constant struggle for me the past few years, and it sometimes manifests as bouts of “why bother if I’m not cut out for it”, i.e. a fixed mindset. Going deeper in the topic via the book has helped me become more aware of my fixed mindsets, and enabled me to action on it. I regret not reading it earlier.&lt;/p&gt;
&lt;p&gt;The fixed mindset reared it’s head a few times over the course. At the beginning, I had contemplated giving up after struggling to understand some big-Oh proofs. Most recently, I struggled with self-confidence after failing the weekly problem assignment. Thankfully, I stuck with it, mostly on the thinking of “well, at least I’ll learn something”. There was some personal vindication when I realised I was able to solve all of the questions in the final exam (albeit I still had to take it twice, due to some misreading and miscalculation).&lt;/p&gt;
&lt;p&gt;It’s not a perfect book by any means - I’ve found it repetitive and generalising at times - but it’s been more effective at helping me apply the concepts than watching explainer videos or reading articles.&lt;/p&gt;
&lt;h2&gt;3. Cautious Optimism&lt;/h2&gt;
&lt;p&gt;My knowledge base is still pretty small, it will be interesting to see whether this still holds up over time, especially as I start taking more courses and learning more things at work. I’m also not very disciplined with regularly going through the base to build connections, but I think that’s also part of it’s beauty - minimal process and mental overheads. Let’s see how the rest of the year pans out!&lt;/p&gt;
&lt;p&gt;What’s your learning workflow?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[TIL: Extending a Ruby Struct]]></title><description><![CDATA[Last week I had a head-scratching moment looking at the following code (from the google-api-ruby-client): My initial confusion stemmed from…]]></description><link>https://www.wasabigeek.com/blog/til-extending-a-ruby-struct/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/til-extending-a-ruby-struct/</guid><pubDate>Sun, 07 Nov 2021 10:48:03 GMT</pubDate><content:encoded>&lt;p&gt;Last week I had a head-scratching moment looking at the following code (from the &lt;a href=&quot;https://github.com/googleapis/google-api-ruby-client/blob/google-apis-core/v0.4.1/google-apis-core/lib/google/apis/options.rb&quot;&gt;google-api-ruby-client&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;ClientOptions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:application_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:application_version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:proxy_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:open_timeout_sec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:read_timeout_sec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:send_timeout_sec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:log_http_requests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:transparent_gzip_decompression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClientOptions&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;default&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@options&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClientOptions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;My initial confusion stemmed from the assumption that the first &lt;code class=&quot;language-text&quot;&gt;ClientOptions&lt;/code&gt; declaration returned a regular object. A helpful colleague explained to me that &lt;code class=&quot;language-text&quot;&gt;Struct.new&lt;/code&gt; actually returns a subclass of &lt;a href=&quot;https://ruby-doc.org/core-3.0.2/Struct.html&quot;&gt;Struct&lt;/a&gt;. That meant the second &lt;code class=&quot;language-text&quot;&gt;class ClientOptions&lt;/code&gt; declaration was actually &lt;em&gt;re-opening&lt;/em&gt; the class to add a method, not to declare a new class.&lt;/p&gt;
&lt;p&gt;Why would one want to do this? Well, one would get all the methods of a regular Struct (e.g. accessors, iterators) &lt;s&gt;for free&lt;/s&gt; at the cost of the inheritance hierarchy. This could be useful for &lt;a href=&quot;https://martinfowler.com/bliki/ValueObject.html&quot;&gt;ValueObjects&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Meta-Postgres: What constraints does a table have?]]></title><description><![CDATA[TIL that checking the structure of your database is just another query away! I needed to find whether a CHECK constraint existed and learnt…]]></description><link>https://www.wasabigeek.com/blog/meta-postgres-what-constraints-does-a-table-have/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/meta-postgres-what-constraints-does-a-table-have/</guid><pubDate>Sun, 16 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;TIL that checking the structure of your database is just another query away! I needed to find whether a CHECK constraint existed and learnt that Postgres has &lt;a href=&quot;https://www.postgresql.org/docs/current/information-schema.html&quot;&gt;information_schema&lt;/a&gt; views and &lt;a href=&quot;https://www.postgresql.org/docs/current/catalogs.html&quot;&gt;system catalogs&lt;/a&gt; which you can query like regular tables.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;information_schema&lt;/code&gt; is actually defined by the SQL standard, so other SQL-compliant databases should have them too. I tried looking first at &lt;a href=&quot;https://www.postgresql.org/docs/current/infoschema-columns.html&quot;&gt;columns&lt;/a&gt;, then &lt;a href=&quot;https://www.postgresql.org/docs/current/infoschema-constraint-column-usage.html&quot;&gt;constraint_column_usage&lt;/a&gt;. Neither had quite what I was looking for, as they did not include the constraint definition.&lt;/p&gt;
&lt;p&gt;Then I found out that each &lt;code class=&quot;language-text&quot;&gt;information_schema&lt;/code&gt; is actually just a view based upon Postgres’ &lt;a href=&quot;https://postgresql.org/docs/13/interactive/catalogs-overview.html&quot;&gt;system catalog&lt;/a&gt; tables 🤯 For example, check out the SQL for &lt;a href=&quot;https://github.com/postgres/postgres/blob/272d82ec6febb97ab25fd7c67e9c84f4660b16ac/src/backend/catalog/information_schema.sql#L801&quot;&gt;constraint_column_usage&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This meant I had the building blocks to make exactly what I needed! The &lt;code class=&quot;language-text&quot;&gt;pg_node_tree&lt;/code&gt; column contains a representation of the CHECK definition, which can be parsed with &lt;code class=&quot;language-text&quot;&gt;pg_get_constraintdef&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; pg_get_constraintdef&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;oid
  &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt;   pg_constraint c
  &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt;  c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;conrelid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;my_table&apos;&lt;/span&gt;::regclass
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(Note to self: the additional parentheses is to evaluate the select result as a value expression / scalar, as opposed to a table.)&lt;/p&gt;
&lt;p&gt;That would give you a result like:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;pg_get_constraintdef&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;CHECK ((description &amp;lt;&gt; &apos;&apos;::text))&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Appendix&lt;/h2&gt;
&lt;h3&gt;Pro-Tips&lt;/h3&gt;
&lt;p&gt;Twitter user &lt;a href=&quot;https://twitter.com/ascherbaum&quot;&gt;ascherbaum&lt;/a&gt; has pointed out that when using &lt;code class=&quot;language-text&quot;&gt;psql&lt;/code&gt;, you can use &lt;code class=&quot;language-text&quot;&gt;-e -E&lt;/code&gt; arguments to show the underlying SQL which Postgres uses. Pretty neat!&lt;/p&gt;
&lt;h3&gt;Follow-up Questions&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Are the catalogs stored like any other table, or is there some magic that makes them table-like?&lt;/li&gt;
&lt;li&gt;Does pg_get_constraintdef work with other types of constraints? The docs suggest not.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Don’t give up on your Rails Generators!]]></title><description><![CDATA[Many Rails devs I’ve spoken to quickly stop using the built-in generators - the common reason is that the generated files no longer suit the…]]></description><link>https://www.wasabigeek.com/blog/dont-give-up-on-your-rails-generators/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/dont-give-up-on-your-rails-generators/</guid><pubDate>Sun, 14 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Many Rails devs I’ve spoken to quickly stop using the built-in generators - the common reason is that the generated files no longer suit the project, so it’s easier to start from scratch rather generate and then modify them. What a pity! To paraphrase DHH, generators can help &lt;strong&gt;improve team productivity&lt;/strong&gt; and &lt;strong&gt;encourage consistency&lt;/strong&gt; - we just need to tweak them.&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;A good way to get more people to do the right thing: Generate the pattern by default via built-in generators. Like we do with tests etc.&lt;/p&gt;&amp;mdash; DHH (@dhh) &lt;a href=&quot;https://twitter.com/dhh/status/176466771698659328?ref_src=twsrc%5Etfw&quot;&gt;March 5, 2012&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;In this post, I look at one approach for customising generators, based on one we customised recently at work: the rake task generator.&lt;/p&gt;
&lt;h2&gt;TL;DR on Overriding a Generator&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Copy over the Generator classes to &lt;code class=&quot;language-text&quot;&gt;/lib/generators/...&lt;/code&gt; and modify&lt;/li&gt;
&lt;li&gt;Copy over the template file to &lt;code class=&quot;language-text&quot;&gt;/lib/templates/...&lt;/code&gt; and modify&lt;/li&gt;
&lt;li&gt;Bonus: Use &lt;code class=&quot;language-text&quot;&gt;hook_for&lt;/code&gt; to generate a test file if the generator doesn’t do it automatically&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;The Problem&lt;/h2&gt;
&lt;p&gt;At work, we use rake tasks quite a fair bit, both for cron-like jobs and one-off migration or support tasks. Rails has a built-in &lt;a href=&quot;https://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/task/USAGE&quot;&gt;task generator&lt;/a&gt;, with the form:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;bin/rails g task file_name &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s never quite worked for us:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We like to keep one task “action” per file, with the file named the same as the action - this makes it easier to grep for the task. The built-in generator requires separate &lt;code class=&quot;language-text&quot;&gt;file_name&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;action&lt;/code&gt; arguments, which is a little unnecessary.&lt;/li&gt;
&lt;li&gt;We sometimes namespace tasks e.g. with a “onetime” namespace for one-off tasks, but the built-in generator ignores paths in the &lt;code class=&quot;language-text&quot;&gt;file_name&lt;/code&gt; and also uses the &lt;code class=&quot;language-text&quot;&gt;file_name&lt;/code&gt; as the namespace.&lt;/li&gt;
&lt;li&gt;We write tests for our rake tasks, but the generator doesn’t create test files.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s address these! There are different approaches available, but in this case it made sense to override the generator entirely - the team wasn’t using it, so we weren’t breaking established conventions.&lt;/p&gt;
&lt;h2&gt;Overriding the Task Generator&lt;/h2&gt;
&lt;p&gt;Rails searches for generators in a &lt;a href=&quot;https://guides.rubyonrails.org/generators.html#generators-lookup&quot;&gt;few paths&lt;/a&gt;, so as long as we place our file in &lt;code class=&quot;language-text&quot;&gt;/lib/generators/task/task_generator.rb&lt;/code&gt;, Rails will load our custom file instead.&lt;/p&gt;
&lt;p&gt;We’ll copy over the original task generator to use as a base. Most of the default generators can be found in &lt;code class=&quot;language-text&quot;&gt;railties/lib/rails/generators/rails&lt;/code&gt;, the one we’re after is &lt;a href=&quot;https://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/task/task_generator.rb&quot;&gt;here&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Rails&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Generators&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TaskGenerator&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; NamedBase &lt;span class=&quot;token comment&quot;&gt;# :nodoc:&lt;/span&gt;
      argument &lt;span class=&quot;token symbol&quot;&gt;:actions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;banner&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;action action&quot;&lt;/span&gt;&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create_task_files&lt;/span&gt;&lt;/span&gt;
        template &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;task.rb&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;lib/tasks&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;file_name&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.rake&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Copy it over to &lt;code class=&quot;language-text&quot;&gt;/lib/rails/generators/task/task_generator.rb&lt;/code&gt;. As a simple sanity check to see if we’ve overridden the class, let’s make the generator spit out a hardcoded file name and run it. Change this line:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;template &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;task.rb&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;lib/tasks&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hardcoded_file_name.rake&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then run the command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;bin/rails g task path/to/my_task
&lt;span class=&quot;token comment&quot;&gt;# create  lib/tasks/hardcoded_file_name.rake&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It works! Let’s revert the hardcoding and leave the rest of the class as-is for now. We’ll be back, promise.&lt;/p&gt;
&lt;h2&gt;Overriding the Generator Template&lt;/h2&gt;
&lt;p&gt;We’ll going to be customising the template as well, so let’s override that. When invoked, generators search for templates in a different set of paths from the invoker (I explored this more in another &lt;a href=&quot;https://wasabigeek.com/blog/customising-generator-templates-in-rails-gems-too/&quot;&gt;post&lt;/a&gt;) - we’ll be wanting to place our template at &lt;code class=&quot;language-text&quot;&gt;/lib/templates/rails/task/task.rb.tt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Copy the &lt;a href=&quot;https://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/task/templates/task.rb.tt&quot;&gt;original&lt;/a&gt; and modify it as such (the lack of indentation is intentional):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;% class_path.each_with_index &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;path_fragment, index&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; -%&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;%&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; indent&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;namespace :#{path_fragment}&quot;&lt;/span&gt;, index * &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; %&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;% end -%&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;% content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; capture &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; -%&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
desc &lt;span class=&quot;token string&quot;&gt;&quot;TODO&quot;&lt;/span&gt;
task &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;%&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; file_name %&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;: :environment &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
end
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;% end -%&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;%&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; indent&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;content, class_path.size * &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; %&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;% &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.class_path.size&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;.reverse_each &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;index&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; -%&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;%&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; indent&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;end&apos;&lt;/span&gt;, index * &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; %&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;% end -%&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s breakdown the changes. First, we’ll sort our name-spacing, including the indentation (note that &lt;code class=&quot;language-text&quot;&gt;indent&lt;/code&gt; is actually a private method on &lt;code class=&quot;language-text&quot;&gt;Rails::Generators::Base&lt;/code&gt;, so you won’t be able to use it in your regular view templates):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;% class_path.each_with_index do |path_fragment, index| -%&gt;
&amp;lt;%= indent(&quot;namespace :#{path_fragment}&quot;, index * 2) %&gt; do
&amp;lt;% end -%&gt;
...
&amp;lt;% (0...class_path.size).reverse_each do |index| -%&gt;
&amp;lt;%= indent(&apos;end&apos;, index * 2) %&gt;
&amp;lt;% end -%&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With the previous command &lt;code class=&quot;language-text&quot;&gt;bin/rails g task path/to/my_task&lt;/code&gt;, the above results in:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;namespace :path do
  namespace :to do
    ...
  end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now lets sort the task itself:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
&amp;lt;% content = capture do -%&gt;
desc &quot;TODO&quot;
task &amp;lt;%= file_name %&gt;: :environment do
end
&amp;lt;% end -%&gt;
&amp;lt;%= indent(content, class_path.size * 2) %&gt;
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here, we indent the task description strings by first assigning it to a variable, &lt;code class=&quot;language-text&quot;&gt;content&lt;/code&gt; via the &lt;code class=&quot;language-text&quot;&gt;capture&lt;/code&gt; helper. Then, we indent and insert it into the file. So running the command again will give us:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;namespace :path do
  namespace :to do
    desc &quot;TODO&quot;
    task my_task: :environment do
    end

  end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Almost there! Our file is still being created as &lt;code class=&quot;language-text&quot;&gt;/lib/tasks/my_task.rake&lt;/code&gt; though, instead of &lt;code class=&quot;language-text&quot;&gt;/lib/tasks/path/to/my_task.rake&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Fixing the Generated Path&lt;/h2&gt;
&lt;p&gt;Let’s fix that. Here’s the diff for our generator:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff&quot;&gt;&lt;code class=&quot;language-diff&quot;&gt;&lt;span class=&quot;token coord&quot;&gt;4,5d3&lt;/span&gt;
&lt;span class=&quot;token deleted-arrow deleted&quot;&gt;&lt;span class=&quot;token prefix deleted&quot;&gt;&lt;&lt;/span&gt;       argument :actions, type: :array, default: [], banner: &quot;action action&quot;
&lt;span class=&quot;token prefix deleted&quot;&gt;&lt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token coord&quot;&gt;7c5&lt;/span&gt;
&lt;span class=&quot;token deleted-arrow deleted&quot;&gt;&lt;span class=&quot;token prefix deleted&quot;&gt;&lt;&lt;/span&gt;         template &quot;task.rb&quot;, File.join(&quot;lib/tasks&quot;, &quot;#{file_name}.rake&quot;)
&lt;/span&gt;&lt;span class=&quot;token coord&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token inserted-arrow inserted&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;&gt;&lt;/span&gt;         template &quot;task.rb&quot;, File.join(&quot;lib/tasks&quot;, class_path, &quot;#{file_name}.rake&quot;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’ve removed the unnecessary &lt;code class=&quot;language-text&quot;&gt;actions&lt;/code&gt; argument and added the &lt;code class=&quot;language-text&quot;&gt;class_path&lt;/code&gt; to the generated file’s path. Running the command again nests the file nicely now.&lt;/p&gt;
&lt;h2&gt;Hooking in a Test file&lt;/h2&gt;
&lt;p&gt;“Should you test rake tasks?”… is not a discussion for this article, let’s assume you do! We can customise our generator to create a test file.&lt;/p&gt;
&lt;p&gt;The method we’re looking for is &lt;a href=&quot;https://api.rubyonrails.org/v6.1.3/classes/Rails/Generators/Base.html#method-c-hook_for&quot;&gt;hook_for&lt;/a&gt;, which will cause the generator to attempt to also invoke other generators. Add the following DSL to your generator class:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;hook_for &lt;span class=&quot;token symbol&quot;&gt;:test_framework&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In short, this attempts to invoke &lt;code class=&quot;language-text&quot;&gt;Rspec::Generators::TaskGenerator&lt;/code&gt;, which… doesn’t exist yet. Let’s resolve that.&lt;/p&gt;
&lt;h2&gt;Adding RSpec Generator and Template&lt;/h2&gt;
&lt;p&gt;RSpec doesn’t have a custom generator for tasks, but the steps for overriding it are more or less the same. Let’s start by creating the TaskGenerator class in &lt;code class=&quot;language-text&quot;&gt;/lib/generators/rspec/task/task_generator.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# frozen_string_literal: true&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;generators/rspec&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Rspec&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Generators&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TaskGenerator&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; Base &lt;span class=&quot;token comment&quot;&gt;# :nodoc:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create_task_specs&lt;/span&gt;&lt;/span&gt;
        template &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;task_spec.rb&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;spec/tasks&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; class_path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;file_name&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;_rake_spec.rb&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, we need to create the corresponding template in &lt;code class=&quot;language-text&quot;&gt;/lib/templates/rspec/task/task_spec.rb.tt&lt;/code&gt; (note: we can definitely DRY this out more, you might be able to draw some inspiration from these examples by &lt;a href=&quot;https://thoughtbot.com/blog/test-rake-tasks-like-a-boss&quot;&gt;Thoughtbot&lt;/a&gt; and &lt;a href=&quot;https://blog.10pines.com/2019/01/14/testing-rake-tasks/&quot;&gt;10Pines&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;rails_helper&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;rake&apos;&lt;/span&gt;&lt;/span&gt;

describe &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;%= class_path.join(&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;) %&gt;&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  describe &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;:&amp;lt;%= file_name %&gt;&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    before&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      Rake&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;Task&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;define_task&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      Rake&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rake &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Rake&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
      rake&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;rake_require &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;tasks/&amp;lt;%= File.join(class_path, file_name) %&gt;&apos;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token variable&quot;&gt;@task&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rake&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;%= class_path.concat([file_name]).join(&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;) %&gt;&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    it &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;works&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token variable&quot;&gt;@task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With that done, running the generator command now creates the files just as we wanted. Neat!&lt;/p&gt;
&lt;h2&gt;Go forth and generate!&lt;/h2&gt;
&lt;p&gt;I hope this has given you some inspiration to give generators a second chance - with a little tweaking, they can be really useful in saving time for you and your team. What ideas do you have for improving your generators?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How does ActiveRecord know the primary_key?]]></title><description><![CDATA[While trying to help someone debug an  error, I went down a rabbit-hole trying to figure out how Rails determines the primary key. Hopefully…]]></description><link>https://www.wasabigeek.com/blog/how-does-activerecord-know-the-primary-key/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/how-does-activerecord-know-the-primary-key/</guid><pubDate>Sat, 13 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;While trying to help someone debug an &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::UnknownPrimaryKey&lt;/code&gt; error, I went down a rabbit-hole trying to figure out how Rails determines the primary key. Hopefully this provides a tiny bit more insight on how Rails works!&lt;/p&gt;
&lt;h2&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;If you’re using Postgres, ActiveRecord searches for a primary key index on the table. If you’re using a different database, the answer probably lies in the respective &lt;code class=&quot;language-text&quot;&gt;SchemaStatements&lt;/code&gt; of the adapter, e.g. &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::ConnectionAdapters::MySQL::SchemaStatements&lt;/code&gt; (&lt;a href=&quot;https://github.com/rails/rails/blob/main/activerecord/lib/active_record/connection_adapters/mysql/schema_statements.rb&quot;&gt;source&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Finding the Primary Key&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ActiveRecord::Base&lt;/code&gt; includes the &lt;code class=&quot;language-text&quot;&gt;AttributeMethods&lt;/code&gt; module, which in turn includes &lt;code class=&quot;language-text&quot;&gt;PrimaryKey&lt;/code&gt;. The module has a &lt;code class=&quot;language-text&quot;&gt;#primary_key&lt;/code&gt; &lt;a href=&quot;https://github.com/rails/rails/blob/main/activerecord/lib/active_record/attribute_methods/primary_key.rb#L70&quot;&gt;method&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;primary_key&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token variable&quot;&gt;@primary_key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; reset_primary_key &lt;span class=&quot;token keyword&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;defined&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;@primary_key&lt;/span&gt;
  &lt;span class=&quot;token variable&quot;&gt;@primary_key&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If we follow the &lt;code class=&quot;language-text&quot;&gt;#reset_primary_key&lt;/code&gt; method, we’ll eventually reach &lt;code class=&quot;language-text&quot;&gt;#get_primary_key&lt;/code&gt;, which tries to get the key from the &lt;code class=&quot;language-text&quot;&gt;SchemaCache&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;get_primary_key&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; ActiveRecord&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;Base &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; table_exists&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
      pk &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema_cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;primary_keys&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;table_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the &lt;a href=&quot;https://github.com/rails/rails/blob/v6.1.2.1/activerecord/lib/active_record/connection_adapters/schema_cache.rb&quot;&gt;SchemaCache&lt;/a&gt;, we see that if the &lt;code class=&quot;language-text&quot;&gt;primary_keys&lt;/code&gt; cache does not already have the key, it will attempt to call &lt;code class=&quot;language-text&quot;&gt;connection.primary_key(table_name)&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;primary_keys&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;table_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token variable&quot;&gt;@primary_keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;table_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# if the table_name key isn&apos;t in the Hash, execute this block&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@primary_keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;deep_deduplicate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;table_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; deep_deduplicate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;primary_key&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;table_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This method is found in &lt;a href=&quot;https://github.com/rails/rails/blob/v6.1.2.1/activerecord/lib/active_record/connection_adapters/abstract/schema_statements.rb#L148&quot;&gt;SchemaStatements&lt;/a&gt;, and it in turn attempts to call &lt;code class=&quot;language-text&quot;&gt;#primary_keys&lt;/code&gt;. This call goes to the database adapter, in my case &lt;a href=&quot;https://github.com/rails/rails/blob/main/activerecord/lib/active_record/connection_adapters/postgresql/schema_statements.rb#L356&quot;&gt;PostgreSQL::SchemaStatements&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;primary_keys&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;table_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# :nodoc:&lt;/span&gt;
  query_values&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SQL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;SCHEMA&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attname
      &lt;span class=&quot;token constant&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
             &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt;
               &lt;span class=&quot;token constant&quot;&gt;FROM&lt;/span&gt; pg_index
              &lt;span class=&quot;token constant&quot;&gt;WHERE&lt;/span&gt; indrelid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#{quote(quote_table_name(table_name))}::regclass&lt;/span&gt;
                &lt;span class=&quot;token constant&quot;&gt;AND&lt;/span&gt; indisprimary
           &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; i
      &lt;span class=&quot;token constant&quot;&gt;JOIN&lt;/span&gt; pg_attribute a
        &lt;span class=&quot;token constant&quot;&gt;ON&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attrelid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;indrelid
       &lt;span class=&quot;token constant&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attnum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;indkey&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;idx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
     &lt;span class=&quot;token constant&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BY&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;idx
  &lt;span class=&quot;token constant&quot;&gt;SQL&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The subquery in particular is crucial - basically, Rails looks for a primary key index belonging to the table. Let’s focus on the important bits:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;/* from all the indexes */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; pg_index
&lt;span class=&quot;token comment&quot;&gt;/* find those for table_name */&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;/* you can google for regclass, it&apos;s another Postgres rabbit-hole */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; indrelid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; table_name::regclass
&lt;span class=&quot;token comment&quot;&gt;/* that are primary keys */&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; indisprimary&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is usually automatically created during a migration - Rails will add an &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt; column and make it a primary key. If you have a &lt;code class=&quot;language-text&quot;&gt;structure.sql&lt;/code&gt; file, you’d find statements like &lt;code class=&quot;language-text&quot;&gt;ADD CONSTRAINT table_name_pkey PRIMARY KEY (id)&lt;/code&gt; which do exactly that.&lt;/p&gt;
&lt;h2&gt;Bonus: How did I find it?&lt;/h2&gt;
&lt;p&gt;It took me quite a while to figure this out, I’m sharing my abridged (because I was flailing around a &lt;em&gt;lot&lt;/em&gt;) methodology in hopes that it might be helpful to you when debugging - if you know a better way, do share!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Did a GitHub search in the Rails repo for the UnknownPrimaryKey error. There were a few results that were in the form &lt;code class=&quot;language-text&quot;&gt;finder_class.primary_key&lt;/code&gt;, so I assumed it was a method on the model (and confirmed that by playing around in the rails console).&lt;/li&gt;
&lt;li&gt;Did another search for &lt;code class=&quot;language-text&quot;&gt;&quot;def primary_key&quot;&lt;/code&gt; (“primary_key” alone gave too many results), this led to &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::AttributeMethods::PrimaryKey&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Wasn’t sure that this was the correct method but I attempted to follow the code through (GitHub’s &lt;a href=&quot;https://docs.github.com/en/github/managing-files-in-a-repository/navigating-code-on-github#jumping-to-the-definition-of-a-function-or-method&quot;&gt;jump to definition&lt;/a&gt; was a godsend) and got a little stuck/distracted by trying to figure out what class &lt;code class=&quot;language-text&quot;&gt;connection&lt;/code&gt; referred to.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;After a bit of poking around in the console, I recalled seeing this class called &lt;a href=&quot;https://ruby-doc.org/core-2.7.2/TracePoint.html&quot;&gt;TracePoint&lt;/a&gt;, and decided to give it a try:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;trace &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TracePoint&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;new&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;:raise&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;tp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
    p &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;lineno&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;raised_exception&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

trace&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;enable&lt;/span&gt; { ExampleModel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;first&lt;/span&gt; }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;This gave an extremely long trace 🤯  good thing I could search in my terminal, after grepping for &lt;code class=&quot;language-text&quot;&gt;primary_keys&lt;/code&gt; I came across this set of calls, which confirmed that the method was in &lt;code class=&quot;language-text&quot;&gt;PostgreSQL::SchemaStatements&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;, ActiveRecord::ConnectionAdapters::SchemaCache, :primary_keys, :call&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;53&lt;/span&gt;, ActiveRecord::ConnectionAdapters::SchemaCache, :data_source_exists?, :call&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;146&lt;/span&gt;, ActiveRecord::ConnectionAdapters::SchemaStatements, :primary_key, :call&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;355&lt;/span&gt;, ActiveRecord::ConnectionAdapters::PostgreSQL::SchemaStatements, :primary_keys, :call&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Window Functions, Visualised - Rankings]]></title><description><![CDATA[Leading from an introduction to Window Function Calls, let’s dive deeper into the different Window Functions that are available. Today, we…]]></description><link>https://www.wasabigeek.com/blog/window-functions-visualised-rankings/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/window-functions-visualised-rankings/</guid><pubDate>Mon, 04 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Leading from an &lt;a href=&quot;/blog/window-function-calls-an-introduction/&quot;&gt;introduction to Window Function Calls&lt;/a&gt;, let’s dive deeper into the different Window Functions that are available. Today, we’ll look at &lt;code class=&quot;language-text&quot;&gt;row_number&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;rank&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;dense_rank&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;percent_rank&lt;/code&gt;. We’ll be using the same expenses table from the previous post, which had entries like:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;In the following examples, our &lt;strong&gt;window frame&lt;/strong&gt; will be the whole expenses table, ordered by highest to lowest cost:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; window &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OVER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; cost &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  expenses&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;description&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  expenses&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cost
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; expenses&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/116c3063fe1adc7cbe60400693705952/17d12/window_frame.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVQoz3WSW4+iQBCF/f+/anYfTJyNWR1xxAsqFxHkDt1yETibUxsmmYeppEOnOf111amaAUDXA1U7QLcD8rpHXg/4KahV1HYDwrJD14/f/s+aukZaamy9Anak4MQKq0uMQtVomwZKKQzDIKtSCqegwMZOYfsRlgcPeztAkWdIkgRN02D2eDxw2O+xN3f4877A7tOAqgqcLQue5yGKIoFSfDwe8L5Y4PevN3ysVwBGedQwDJRFIVABmuYe2+0Wy+USq9UajyiS/fV6RRAE0Frh+XzCcVyYpinLtm0B3O93GJsNfN+X/SxNU+R5Dv92g+u6sCxLvGBmjLIsobWWDPPQwufWwGZjiJZR17VU0nUdkjj+D+Sl8/mMMAxF9Hq9JLNxHKVcRWAZIgkcrNcfOB6P4imD95ktI56AVVWJiAeMvu/huS6GCZg4UEWMstJSDbOago8SzjsCzLJMRPP5XDxjtG0Lx3GAoUMV2yjPb6hufwUojWhbAU1a2kHoV4b0iLDT6SResmQCX3WBKn+gdJdQ/hpZVsCyTtLAqWRWMNnzBeQhTWan2AyK8ywDc6h0DRXuoBIXSj+/DfEEnXwXIAGs/ydhmiYYRkDrp3SRY3a5XCSrKThSzFDmkB2miOBp8SV+CZsushGcAlrBiWBFrIw94J59YLX/ABO5jgdtdQFNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Original table to window frame&quot;
        title=&quot;Original table to window frame&quot;
        src=&quot;/static/116c3063fe1adc7cbe60400693705952/fcda8/window_frame.png&quot;
        srcset=&quot;/static/116c3063fe1adc7cbe60400693705952/12f09/window_frame.png 148w,
/static/116c3063fe1adc7cbe60400693705952/e4a3f/window_frame.png 295w,
/static/116c3063fe1adc7cbe60400693705952/fcda8/window_frame.png 590w,
/static/116c3063fe1adc7cbe60400693705952/efc66/window_frame.png 885w,
/static/116c3063fe1adc7cbe60400693705952/c83ae/window_frame.png 1180w,
/static/116c3063fe1adc7cbe60400693705952/17d12/window_frame.png 1666w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;row_number&lt;/h2&gt;
&lt;p&gt;Let’s start with &lt;code class=&quot;language-text&quot;&gt;row_number&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ROW_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OVER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; cost &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All &lt;code class=&quot;language-text&quot;&gt;row_number&lt;/code&gt; does is add a running number for each row in the frame, starting from 1:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;row_number&lt;/th&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;groceries&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;dinner&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;taxi&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;supper&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;tea break&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;dense_rank&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;dense_rank&lt;/code&gt; is more interesting. Reviewing the previous example, we can see that there were a few entries that have the same cost. The Postgres documentation refers to these as &lt;strong&gt;peer groups&lt;/strong&gt;, and &lt;code class=&quot;language-text&quot;&gt;dense_rank&lt;/code&gt; adds a running number counting by the groups instead of rows:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5ebdb9248832051f5d8c653f55af4d0e/ce92a/dense_rank.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACV0lEQVQ4y22UW3PaMBBG+/9/TtP3NsNLQtJ0BibQkJBgg7F8v8rGWPLpSA6ETqKZnV3Z2qNP0krfAIZhMI44jtntdvi+TxiGNhZCEMeRjV3XJU1TPM9jvX5BCN9+3+/3Nse0b5fAKIosdDqdMp/PuL7+ZQcr1bNYPPLw8MDxeGS1WnF19Z3ZbMZkMmGz2VgBn4AmeWtUBUbRHhGERHFCkmbkRUlZ1uR5QVEUlGVFnueUZWGFGPWfgIVJKjJQEt1Vox1rUC2gYOhGb9vJj/lnhaZzAkrZEAuXzdMfXp8XoBqGrqSXEevFLTJ6QWcrzGhVuuhjM6KVIgyDD4UwAoOsxvE8mmBJ5i3Q1RZd7VC1TxF79G0OvXwfzdkbYBC8A6uD4uatIJGKNK8oI4fYf+P3zTVZuAXd0DcZvvOXvg4ZuuIM4gL436Fs0xY36ygqydZ9oa5KfBFS1fKsxJSLOW1de7ava5+hb87wJEnoum4EPgnJfC/JS4kQHnnosl6/UuTZWYWpubZtQfqYLTd7O6gD79tvJ5RSjkAnaZk6Fa8i55ALyixkuXrD88dlHHtFmuUoPTC0yRkynrD+DOx6jRpgl9RWYRsuebz/yX79AAfBMX1GrO84REuG2htBR/m1wuFiOtlpts4zm+UdztM9t9c/mN9PYDjw9vxoT1mXjh2rmxBt1PLFki9rMfY3FJFLGjiU8Y48dBgOGV0ZoJvYxpftlJdl2ddAXwh6pdBan5NMbP4br/XJK2umZMaHJaKu61Nhf8wkfN++HKZQRxMX8WjmVlz2T3fZVME/fpJ8fV3LF/0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Dense Rank Peer Groups&quot;
        title=&quot;Dense Rank Peer Groups&quot;
        src=&quot;/static/5ebdb9248832051f5d8c653f55af4d0e/fcda8/dense_rank.png&quot;
        srcset=&quot;/static/5ebdb9248832051f5d8c653f55af4d0e/12f09/dense_rank.png 148w,
/static/5ebdb9248832051f5d8c653f55af4d0e/e4a3f/dense_rank.png 295w,
/static/5ebdb9248832051f5d8c653f55af4d0e/fcda8/dense_rank.png 590w,
/static/5ebdb9248832051f5d8c653f55af4d0e/efc66/dense_rank.png 885w,
/static/5ebdb9248832051f5d8c653f55af4d0e/c83ae/dense_rank.png 1180w,
/static/5ebdb9248832051f5d8c653f55af4d0e/ce92a/dense_rank.png 1459w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So changing the SQL to this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; DENSE_RANK&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OVER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; cost &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Gives us this:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;dense_rank&lt;/th&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;groceries&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;dinner&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;taxi&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;supper&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;tea break&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: I’m actually not sure how Postgres orders the rows &lt;em&gt;within&lt;/em&gt; a peer group - in my small example, it looks like an implicit &lt;code class=&quot;language-text&quot;&gt;ORDER BY ID DESC&lt;/code&gt; was added, but the Postgres &lt;a href=&quot;https://www.postgresql.org/docs/current/queries-order.html&quot;&gt;docs&lt;/a&gt; also say for general ordering, &lt;em&gt;if sorting is not chosen, the rows will be returned in an unspecified order&lt;/em&gt; 🤷‍♂️.&lt;/p&gt;
&lt;h2&gt;rank&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rank&lt;/code&gt; has one big difference from &lt;code class=&quot;language-text&quot;&gt;dense_rank&lt;/code&gt; - it counts the “gaps” in the previous peer group:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/16828e5d43e47a6d721fa4d21f043acd/c1b63/rank.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+ElEQVQ4y6WU227bOBCG/f6vshe52VxsDeyim7WLpA0at/ExsWzLkiz5KEWWSEoUv4K0641R7NUOMBgOQf6c+Yczrc1mg+/7rNdrdrsd1rfW+mEYOl2tVkRRdPGtxnHs9qwNggDP86jrmpbdtCCdTofRaMTd3R23t7fusJX9fs/Dw4MDsbLdbrm5ueH+/t7ttdsfEEK4c2VZ0vL9BbPZjPF4RL//zNPTVwaDPv5iQZIk7pI3nbK0WSSJi8Y+PJlM3L3hcOjOvLy8oJSiZZ00y2gMFEJS1Q3agKo0QlZOVVVffCUltW6oa+0AbJpWl8slUkpalgOlJFQH0CnIHUZsnUXsQGfQ5JgygSp3aaPlSd+JxbGpt+JkjSozlpNHut0O29gHXaBFCk3B4rXPZPCEKRL0fuwuN8cY/eaf1k3jrC2cA7TpHvZbqnTBIZ7SlKfonFUp2cYn30eYOsPUhbtsTIMx5rw214BCKuJwTrF5ZTG8Z9TrILMIY9NVB3axx2bWp5n30cfsKk0L9iugqljNvlOVGYvFAn8+pZIlNBU0ijw/sPNniD9/R82fT0C6clH+Z4RJNCddz1klG8bjMW95fonikGYkcULV+4Ic/XPiLQ/R6fQE+I5DV2WXcuSjspAgXBEEtvziApi9ZazCiOr5EfX65RxhjanlVYS2OfI8t4CSOFpS5bGLsD8YsdnuL4DpW0GWHlGfP6G8b++4u+awKArXri0hSpL1jiqdMXzqcPfXH6TbEEwBx5D1vEcw+Yz8+Bvi60eaQmC0viqMFcuf/YstISRx4FGuh+TBI4fFA/PeB4LB3yBi9uGQQzSCMkTnAfJbjzoK0but4+8noKXJ8tiyLRfPvhP6UzrdT64n2+023W7XHVzHIatwCVWGTr1TUaRAea+/ROgAXYWiEHFYgrKfegMmg3pPfYwxtgXlHi0ONLU689ZgzmA/O+UK0OZea8P/ETsgLoBhGDDzPFZ2iAaBG1H2+wTn9b97wWnAvl+HgZuddpRZ+wNKmVVpFSZbogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Rank Peer Groups&quot;
        title=&quot;Rank Peer Groups&quot;
        src=&quot;/static/16828e5d43e47a6d721fa4d21f043acd/fcda8/rank.png&quot;
        srcset=&quot;/static/16828e5d43e47a6d721fa4d21f043acd/12f09/rank.png 148w,
/static/16828e5d43e47a6d721fa4d21f043acd/e4a3f/rank.png 295w,
/static/16828e5d43e47a6d721fa4d21f043acd/fcda8/rank.png 590w,
/static/16828e5d43e47a6d721fa4d21f043acd/efc66/rank.png 885w,
/static/16828e5d43e47a6d721fa4d21f043acd/c83ae/rank.png 1180w,
/static/16828e5d43e47a6d721fa4d21f043acd/c1b63/rank.png 1200w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Let’s compare the results of each function to show the difference:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;dense_rank&lt;/th&gt;
&lt;th&gt;rank&lt;/th&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;percent_rank&lt;/h2&gt;
&lt;p&gt;This is an interesting one - how it’s derived is a bit of a mouthful, so let’s show by example, starting with the query:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; PERCENT_RANK&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OVER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; cost &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And the result:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;percent_rank&lt;/th&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;groceries&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.11…&lt;/td&gt;
&lt;td&gt;dinner&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.22…&lt;/td&gt;
&lt;td&gt;taxi&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.33…&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.33…&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.33…&lt;/td&gt;
&lt;td&gt;supper&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.66…&lt;/td&gt;
&lt;td&gt;tea break&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.77…&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.88…&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0.88…&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Instead of a running number, we get the “relative rank” from 0 to 1 inclusive. This is useful if you need to know how close something is to the highest rank - though, as the above example shows, it may not end with 1 if there are ties for the highest rank (a deeper explanation &lt;a href=&quot;https://dba.stackexchange.com/a/144015&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;side-by-side&lt;/h2&gt;
&lt;p&gt;Finally, let’s look at results side by side:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;row_number&lt;/th&gt;
&lt;th&gt;dense_rank&lt;/th&gt;
&lt;th&gt;rank&lt;/th&gt;
&lt;th&gt;percent_rank&lt;/th&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;groceries&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0.11…&lt;/td&gt;
&lt;td&gt;dinner&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0.22…&lt;/td&gt;
&lt;td&gt;taxi&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0.33…&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0.33…&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0.33…&lt;/td&gt;
&lt;td&gt;supper&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;0.66…&lt;/td&gt;
&lt;td&gt;tea break&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;0.77…&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;0.88…&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;0.88…&lt;/td&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;I hope that helped! Here’s an &lt;a href=&quot;http://sqlfiddle.com/#!17/d3ff0a/8&quot;&gt;sqlfiddle&lt;/a&gt; you can play around with.&lt;/p&gt;
&lt;p&gt;In future articles, we’ll look into more window functions. Follow me on Twitter to be informed of the next one!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Window Function Calls in Postgres - A Visual Introduction]]></title><description><![CDATA[What is a window function call? My explanation: adds a column to query results that is calculated based on other rows in the table Ok, that…]]></description><link>https://www.wasabigeek.com/blog/window-function-calls-an-introduction/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/window-function-calls-an-introduction/</guid><pubDate>Thu, 31 Dec 2020 21:56:03 GMT</pubDate><content:encoded>&lt;p&gt;What is a &lt;strong&gt;window function call&lt;/strong&gt;? My explanation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;adds a column to query results that is calculated based on other rows in the table&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ok, that’s probably still not immediately understandable, so let’s walk through an example. Imagine you’ve been tracking expenses in Postgres:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;category&lt;/th&gt;
&lt;th&gt;created_at&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Now, say you wanted to see how much each expense compares to the average:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;category&lt;/th&gt;
&lt;th&gt;created_at&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;th&gt;avg&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;17.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;17.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;You &lt;em&gt;could&lt;/em&gt; use a subquery to calculate the average:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;avg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cost&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; expenses&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; expenses&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But we could also be a little fancier and use a window function call:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;avg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cost&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;over&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; expenses&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Although we have some new syntax to understand (which we’ll get into later), that’s noticeably shorter! What just happened?&lt;/p&gt;
&lt;h2&gt;Hello, Window Frames&lt;/h2&gt;
&lt;p&gt;Let’s try to visualise the window function call. For each row, Postgres calculates the average cost of the rest of the table, which is the default &lt;strong&gt;“window frame”&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1014b18a4b3fbfc949cb36a9403672a2/2bef9/avg_cost_whole_table.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACC0lEQVQoz4VS21LbMBDl//+lj32jT71AKSTAYIc4diCO5Ztk3ezYkixpO3ZgEjqd9owedkd79uwe6cIDeJjgnPfHCMB7MGacjxnH0QNY55TSczYqpay1AHBxrLbOaT3gKmcUFyhtSOWt9lY7a4zRuK6EEN2ha5qmqmtKWdd1E7lTkJSwzkZMu7tg/3MZXy82yyAtqcmwRiVH8dPy+uv6/ga9bFBJovVqvQqEEBOZd7DYQsn81bN5LXpExmQvawEZNohBnWdNme9rTRoRrxOSrkDtR4k4l29je4CbyF3eTzovSDys9hV3JYOMwq5oi13y9KpiNERBIDoNfWZJSHk7kd8N81skUzzmeMBciR56DXoE67wjT8Z6a123vx2UAsNt+qVpyEkZAKRgnWRJHDFGZ8P9m+8sJIQw0R7KVc/Q5K5Im/Tx5DYACCGMMcf6M3igwbFRmwc9TSey6kj87V15vmOMbbfbMAwZY2dcDzTcRFFeEdNsRJUAwKgPePPjT2Xn3GngM+W+PyjjvNxRFM2/YsDxlR7dB7Ke4c9grRvQHRet7N2hCHbPtzUfyOui2D4ae6aslOKcCyH4CUwyPKBFv/veZ79U/FkWq1YKVT54qz+M/XcoAvIFkk+A7yC7BLKAPgcR+3m9f5DnzY2E8gYGAqaFeulp6BXzVh0r/qfsLTQh9PUUjN3U4uwxfwPYyFhU/HYWBQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Calculating average cost over the default window frame&quot;
        title=&quot;Calculating average cost over the default window frame&quot;
        src=&quot;/static/1014b18a4b3fbfc949cb36a9403672a2/fcda8/avg_cost_whole_table.png&quot;
        srcset=&quot;/static/1014b18a4b3fbfc949cb36a9403672a2/12f09/avg_cost_whole_table.png 148w,
/static/1014b18a4b3fbfc949cb36a9403672a2/e4a3f/avg_cost_whole_table.png 295w,
/static/1014b18a4b3fbfc949cb36a9403672a2/fcda8/avg_cost_whole_table.png 590w,
/static/1014b18a4b3fbfc949cb36a9403672a2/efc66/avg_cost_whole_table.png 885w,
/static/1014b18a4b3fbfc949cb36a9403672a2/2bef9/avg_cost_whole_table.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Now if that was all you could do with window function calls, I’d be disappointed too. Thankfully, it’s not! Aside from being shorter, there are some key features that are harder to replicate with subqueries:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;calculations can be done over a subset of the table (i.e. a smaller &lt;strong&gt;window frame&lt;/strong&gt;) instead of the whole table&lt;/li&gt;
&lt;li&gt;in addition to the usual aggregation functions like &lt;code class=&quot;language-text&quot;&gt;avg&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;max&lt;/code&gt;, there are &lt;strong&gt;window functions&lt;/strong&gt;, which can only be used as part of a window function call&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Reframing the Window&lt;/h2&gt;
&lt;p&gt;Let’s try calculating over a subset. Knowing the average across all expenses wasn’t very helpful - a big purchase could skew the calculation, so let’s instead compare each expense to the &lt;em&gt;category average&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;avg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cost&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;over&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; category&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;avg in category&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; expenses&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our result now looks something like:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;category&lt;/th&gt;
&lt;th&gt;created_at&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;th&gt;avg in category&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;tea break&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;taxi to home&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;7.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bus ride home&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;7.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;That’s a bit more helpful! Let’s visualise this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6107b4b5b64a472d789accb94501592f/2bef9/avg_cost_category.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7ElEQVQoz3WTW3PbIBCF/f//Uh97SWZS59qxU0uqLaxIsi4IkAUIAaeDlKStJ93hgRn2A87Z3RUA7/G/8N4tG6WU1hqAtXaQciFWAPSEXoH34/5Yx4e8bM7aoHwhm4d1vH2k1Quvy6f7h8fbG8FZXZWP62vaVAGWI653uEkQ5/ZY8IS0x0oJIUl6jNLmZ1K8VOeWGznaffyLMwFDbfbF0jjA1qHiiAo8Z5bkLCYsq0cqTE7S9fe7ZBc3VdNWVbpPs+iHnUYYAbpZJK3e5VnrU5LVdeM9nIOz5nSqlFTee+ecktKYoBnmDLr9A3uPxYBpMs7Z+cDBKj+dnWq8aqBbI/KxTeAMvAXfL26u/jLWc877vhf9gKlXTbKPttHmTrEcEzuRXZeuYYeQKlJY/er2Es45xtgwDOdhCC8Mhe0Lp1sYBtV61UI3cNMME0zyH3jhrbXOhdqa7iCKZ5ptebGDqsaOTDSCm2WLQ/j8xcuU0rIsy1MFb8Y2btouSWJKKYBejrqJYHjAWHTp9gKzrqvrGoAsnwhJo10keAd4zsWQ3cKeMXL06SUcACm11uO4/C319b3NPiP/CvIpLJYEsnsOjry354dNPTd0i/IKYo/iG4oryDqonX3+APbziPj3QXEj2g2m2fxQ4ent3teE36FvI2lX/+ssAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Calculating average cost over each category&quot;
        title=&quot;Calculating average cost over each category&quot;
        src=&quot;/static/6107b4b5b64a472d789accb94501592f/fcda8/avg_cost_category.png&quot;
        srcset=&quot;/static/6107b4b5b64a472d789accb94501592f/12f09/avg_cost_category.png 148w,
/static/6107b4b5b64a472d789accb94501592f/e4a3f/avg_cost_category.png 295w,
/static/6107b4b5b64a472d789accb94501592f/fcda8/avg_cost_category.png 590w,
/static/6107b4b5b64a472d789accb94501592f/efc66/avg_cost_category.png 885w,
/static/6107b4b5b64a472d789accb94501592f/2bef9/avg_cost_category.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;For each row, our new window frame includes only other rows with the same category, and the average is calculated based on those rows.&lt;/p&gt;
&lt;p&gt;This is also a good time to take a brief look at the syntax we’ve used so far:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;avg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cost&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OVER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; category&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the above:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;avg(cost)&lt;/code&gt; is the aggregation function that we want to execute over the window frame - we could use other functions such as &lt;code class=&quot;language-text&quot;&gt;max&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;min&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;OVER&lt;/code&gt; is the keyword which tells Postgres we were using a window function call. Everything in parentheses specifies how our table will be divided into different window frames&lt;/li&gt;
&lt;li&gt;in this case, we are using &lt;code class=&quot;language-text&quot;&gt;PARTITION BY category&lt;/code&gt;, which means we are dividing the table into different window frames based on their category&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Window Functions&lt;/h2&gt;
&lt;p&gt;Now that we know a little more about the syntax, let’s look at the other hidden power of window functions calls… &lt;strong&gt;window functions&lt;/strong&gt; themselves!&lt;/p&gt;
&lt;p&gt;It’s coming to the end of the month, and you want to know the biggest expense in each category, for each day. There’s a window function for that - &lt;code class=&quot;language-text&quot;&gt;rank&lt;/code&gt;!&lt;/p&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;rank&lt;/code&gt;, we can calculate the order of each row in it’s window frame (Note that the following query still returns every row in the table, not just the top expenses - we’ll fix that later):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  rank&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;over&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; category&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; created_at
    &lt;span class=&quot;token keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; cost &lt;span class=&quot;token keyword&quot;&gt;desc&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; expenses&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice the additional syntax in our window function call:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OVER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; category&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; created_at &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; cost &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;we’ve added a second condition to &lt;code class=&quot;language-text&quot;&gt;PARTITION BY&lt;/code&gt; to further divide each window frame by the day each entry was &lt;code class=&quot;language-text&quot;&gt;created_at&lt;/code&gt; (this is very similar to &lt;code class=&quot;language-text&quot;&gt;GROUP BY&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;there’s now an &lt;code class=&quot;language-text&quot;&gt;ORDER BY ... DESC&lt;/code&gt; that orders the rows within each frame from highest to lowest cost, so we’ll know that a rank of 1 would be the most expensive&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Another quick visual:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2273fb3c2a5f6a4d8b43e62292fa544/2bef9/rank_category_date.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVQoz42RW1PbMBCF/f//EjNkmE65NASIY6zmYohlR3FiI182kkxk7XYcp9DpC5ynndV+OjorD+lrdc4RkVLKOYeITdNorYnIIyJrj1odqqo0xlDXFuli8/rcyJyv47vr69CfxtECCsHuL6vstYEDC8M0TXvYjyna6HEgRjfze7aP+fb26uJy9HMeMpFwFgRPk0n0IqIExtN1svCNMWbHjFZI5P1gtBQYrpW/kizWItfs4XYyfoxXK7nbCh4ny1DyoEpm5frhWPI+Bp6zeuZItSJC13Vd39c5lqs2X74XS6xedBbCdu7Ultq9THxbRuQ6hPREozdcIoSoyrJvwEbyIHr+BbsFKd7mv0GEruYOUhAzhD4qvddn5wF27uxMzvbm7RsdgdBZa12/6n5Ka2Wt/fcXvIEEgKIopJSIlG52T9NgX7wRkZQyy7KBUUqdDQg/YUQEgLqulVJEZIw+AOBpAk+iv6/7qD/hQf8dfEd/ACYyOMjX6E9NAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Calculating rank over each category and date&quot;
        title=&quot;Calculating rank over each category and date&quot;
        src=&quot;/static/c2273fb3c2a5f6a4d8b43e62292fa544/fcda8/rank_category_date.png&quot;
        srcset=&quot;/static/c2273fb3c2a5f6a4d8b43e62292fa544/12f09/rank_category_date.png 148w,
/static/c2273fb3c2a5f6a4d8b43e62292fa544/e4a3f/rank_category_date.png 295w,
/static/c2273fb3c2a5f6a4d8b43e62292fa544/fcda8/rank_category_date.png 590w,
/static/c2273fb3c2a5f6a4d8b43e62292fa544/efc66/rank_category_date.png 885w,
/static/c2273fb3c2a5f6a4d8b43e62292fa544/2bef9/rank_category_date.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So for each row, our window frame is other rows with the same category and created_at date, and we order the rows from highest to lowest cost.&lt;/p&gt;
&lt;p&gt;The query gives us a result like:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;category&lt;/th&gt;
&lt;th&gt;created_at&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;th&gt;rank&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;groceries&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;dinner&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;taxi&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bus ride&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;2020-01-02&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Now that we have a ranking, we could use it as a subquery and filter out expenses that are rank 2 or higher.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;-- our earlier query&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ranked_expenses&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt; rank &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which leaves us with exactly what we want - nice!&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;th&gt;category&lt;/th&gt;
&lt;th&gt;created_at&lt;/th&gt;
&lt;th&gt;cost&lt;/th&gt;
&lt;th&gt;rank&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;groceries&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;food &amp;#x26; drinks&lt;/td&gt;
&lt;td&gt;2020-01-02&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;taxi to home&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;2020-01-01&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bus ride home&lt;/td&gt;
&lt;td&gt;transport&lt;/td&gt;
&lt;td&gt;2020-01-02&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;…&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;I hoped that helped you grok window functions! If you want to play around with the data in this example, there’s an &lt;a href=&quot;http://sqlfiddle.com/#!17/f33e78/3&quot;&gt;sqlfiddle&lt;/a&gt; - in case that doesn’t exist at the time of reading, you can also get the SQL to create the table and query the data from this &lt;a href=&quot;https://gist.github.com/wasabigeek/2b9fb05eba5c26928bab85bcf408511f&quot;&gt;gist&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In the next few articles, we’ll look into the individual window functions, starting with those for &lt;a href=&quot;/blog/window-functions-visualised-rankings/&quot;&gt;ranking rows&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[2020 in Retrospect: Making]]></title><description><![CDATA[Reflections on side projects this year. Overall I tend to build first (out of technical interest or my own personal problem), then make only…]]></description><link>https://www.wasabigeek.com/blog/2020-in-retrospect-making/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/2020-in-retrospect-making/</guid><pubDate>Fri, 11 Dec 2020 20:48:03 GMT</pubDate><content:encoded>&lt;p&gt;Reflections on side projects this year.&lt;/p&gt;
&lt;h2&gt;Overall&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;I tend to build first (out of technical interest or my own personal problem), then make only half-hearted efforts to validate and abandon them quickly.&lt;/strong&gt; There’s two takeaways for me: I should make a proper effort to get better and more comfortable with customer discovery and idea validation, and if it’s to validate an actual business I should do that before building. Will be trying out &lt;a href=&quot;https://twitter.com/PierreDeWulf/status/1329765206256455683?s=20&quot;&gt;some&lt;/a&gt; &lt;a href=&quot;https://www.indiehackers.com/post/how-do-you-create-a-product-people-want-to-buy-a28b69ebb3&quot;&gt;suggestions&lt;/a&gt; around that.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;The “technical” projects were great for personal learning, and fun (until they got serious)&lt;/strong&gt;. I still have a lot to learn and catch up in dev, so I think it’s worth setting aside time for these. Maybe a dual-track thing - set aside 50% time to validate ideas, 50% time to improve technically? Or maybe I should try to capitalise on the learnings e.g. teaching others?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;I abandoned some projects once it became clear they took more effort than expected, so I didn’t see myself making money from them soon&lt;/strong&gt;. Perhaps in addition to the “dual-track” approach, the ideas I should try to validate first should be more around “simpler, one-time sale” products as &lt;a href=&quot;https://robwalling.com/2015/03/26/the-stairstep-approach-to-bootstrapping/&quot;&gt;Rob Walling suggests&lt;/a&gt;. That might take off some pressure on pure-tech projects so I can go deeper.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;I get quite discouraged and annoyed with design&lt;/strong&gt;. I am trying to get better at it for my Dec project, but not in a particularly structured manner. I do think it’ll be useful, just not sure if I should be prioritising that over other things.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Mar 2020&lt;/h2&gt;
&lt;h3&gt;A “self-hosted” Kahoot! clone&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7168019d4007fcce1862971021646b46/1e5d2/cahoots_screenshot.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVQoz3WRu27cMBBF9f9Ik6QwEKTIB7hxYRcu8gGpUgaO11qJu5LWelBePSmJPAaphzdGfIWBOOTwzr1DL8kK0iwnlyXimCCiE3F84hjGhNEzSSYRQUAQHTieUgopiZOURz9kLyLCpwO7J0EYpwQiwgOYpgmtNcYY7OegNdrg9utCstYNw8A4jkzT6HIzTi63ULLEG8cBKUvK0saL+0speTmfqarKFdbn6q3Rf2CFOMKuxzNG07YdXdehlKLve3qlaJoGpQZXXNf1dsnC1uR54RpfQg1qtaydtbnbcqiUI3GW69rtWbt5IfH3AUEo2AchaZbRNO127q2XbfJmQdO07TwjYzgv1veh4NOXKz5ffefu/ifXN3d8/faDm9v7fwlndYaqHTkVHVpbZTOZjXWWVsnDo8/fnc8xTvADwZ+HHeIQvSNcbP4ODNe/NP24KF0G/n6GH2EjXJVcvNuWr4Tr2rqZ43KtN8JXymq2gqQ5ExwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Cahoots&quot;
        title=&quot;Cahoots&quot;
        src=&quot;/static/7168019d4007fcce1862971021646b46/fcda8/cahoots_screenshot.png&quot;
        srcset=&quot;/static/7168019d4007fcce1862971021646b46/12f09/cahoots_screenshot.png 148w,
/static/7168019d4007fcce1862971021646b46/e4a3f/cahoots_screenshot.png 295w,
/static/7168019d4007fcce1862971021646b46/fcda8/cahoots_screenshot.png 590w,
/static/7168019d4007fcce1862971021646b46/efc66/cahoots_screenshot.png 885w,
/static/7168019d4007fcce1862971021646b46/c83ae/cahoots_screenshot.png 1180w,
/static/7168019d4007fcce1862971021646b46/1e5d2/cahoots_screenshot.png 1630w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In March, I helped out at a church event where we found out Kahoot had unexpectedly restricted the free plan. I thought it’d be cool if there could be a “self-hosted” version for non-profits, and made a really non-user-friendly-but-free prototype with GitHub Pages / React / Airtable&lt;/li&gt;
&lt;li&gt;It had some real UX deficiencies to make it free for me to host, so I wanted to have some testers to see if the tradeoffs were ok before deciding to promote it&lt;/li&gt;
&lt;li&gt;I asked a friend to try it but didn’t really follow-up, and also made a post on Reddit (r/react), more a technical post (not much interaction there though)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;it was fun to give the Airtable API a try, also a good opportunity to get a little more familiar with Promises&lt;/li&gt;
&lt;li&gt;I definitely didn’t feel comfortable promoting the initial version of the project, there were so many hoops someone had to jump through just to even try it (setting up a throwaway Airtable account for example). In hindsight, this was probably a mistake - these are all guesses &gt;_&amp;#x3C;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Apr 2020&lt;/h2&gt;
&lt;h3&gt;A newsletter scraping project&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/901f9f255c7e292a6616408fa84cabda/193c9/til.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 102.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECBQb/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAe/iw2g8vTUA/8QAGxAAAQQDAAAAAAAAAAAAAAAAAAEDERQCECH/2gAIAQEAAQUCMVnUocJLTxaeLTx//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGhAAAgIDAAAAAAAAAAAAAAAAADIBoREgIf/aAAgBAQAGPwInmNWoahqP/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERIRDwMWGR/9oACAEBAAE/IRt1Dw5LRPCMOr4NKG1D/9oADAMBAAIAAwAAABDbLzz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAgEBPxAj/8QAHBAAAgEFAQAAAAAAAAAAAAAAAAERIUFRYfAx/9oACAEBAAE/EKIaSKBTfZCwMQqRdCrQ0tCILxEvrusDxONGnxo//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;todayilearn&quot;
        title=&quot;todayilearn&quot;
        src=&quot;/static/901f9f255c7e292a6616408fa84cabda/1c72d/til.jpg&quot;
        srcset=&quot;/static/901f9f255c7e292a6616408fa84cabda/a80bd/til.jpg 148w,
/static/901f9f255c7e292a6616408fa84cabda/1c91a/til.jpg 295w,
/static/901f9f255c7e292a6616408fa84cabda/1c72d/til.jpg 590w,
/static/901f9f255c7e292a6616408fa84cabda/a8a14/til.jpg 885w,
/static/901f9f255c7e292a6616408fa84cabda/193c9/til.jpg 1093w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There were some really useful newsletters I had been following, but I wished there was a way to consume the articles shared in a more piecemeal manner. For example, Hackernewsletter includes &gt;50 articles each week, I usually end up opening 15 tabs in my mobile Firefox and then slowly consuming them over the week - which you can guess isn’t very successful.&lt;/li&gt;
&lt;li&gt;Spent a week or two repurposing an old project and started scraping the web archives of Hackernewsletter. (I later found out that Hackernewsletter had stopped publishing their archives, so that wouldn’t really work)&lt;/li&gt;
&lt;li&gt;Showed the idea to a friend, who gave some really useful feedback (being able to retrieve the knowledge when it would be useful was a bigger problem than consuming it)&lt;/li&gt;
&lt;li&gt;Also, I couldn’t think of a way to give due credit back to the newsletter creators, unless I worked directly with them (feels like a chicken and egg thing) and I didn’t want to disrupt their income source.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The turnaround time was pretty OK (2 weeks) so not a huge loss&lt;/li&gt;
&lt;li&gt;However, I probably should have led by talking to more people instead of building the backend first - since it was mostly repurposing I didn’t really learn anything new from the technical standpoint&lt;/li&gt;
&lt;li&gt;Also, I didn’t really pursue the knowledge surfacing problem that he raised, because it was pretty nebulous and I was… lazy. Looking at the emphasis on knowledge management solutions now, it does seem like that was another mistake 😞&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Jun 2020&lt;/h2&gt;
&lt;h3&gt;A &lt;del&gt;“self-hosted”&lt;/del&gt; real-time Kahoot! clone&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;This actually still works, feel free to give it a &lt;a href=&quot;https://wasabigeek.github.io/cahoots/#/&quot;&gt;try!&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;I thought it would be an interesting technical exercise to try and make the previous project real-time. Wanted to try something more DIY like socket.io, ended up using Firebase.&lt;/li&gt;
&lt;li&gt;I didn’t really do much validation except showing it to 2 friends, with a lukewarm response&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I also decided against pursuing it further in it’s current form:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Competing with Kahoot! on price was probably not going to work, their plans were still pretty affordable (and it seems, even cheaper now)&lt;/li&gt;
&lt;li&gt;They were focusing on education, so I thought another angle was a casual party game, which incidentally was how I was introduced to Kahoot. Something like an &lt;a href=&quot;https://en.wikipedia.org/wiki/Bishi_Bashi&quot;&gt;MMO bishi-bashi&lt;/a&gt;. I shelved this for a future date because I felt like I didn’t have the expertise for building web games, so it would be a long-build.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Even if it wasn’t exactly what I initially wanted to learn (Firebase abstracted a lot of the real-time aspects), I did walk away with some more knowledge of NoSQL databases, plus some Firebase-specific knowledge (e.g. security rules), which was great.&lt;/li&gt;
&lt;li&gt;Again, didn’t really push on the validation front, possibly because I felt it needed more polish, plus I wasn’t sure if I was going to stick with Firebase if moving to the variety-game idea&lt;/li&gt;
&lt;li&gt;I do feel like the rise of games like Fall Guys and Among Us somewhat validates the MMO casual game… 🤔&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Jul 2020&lt;/h2&gt;
&lt;h3&gt;Over the Kit&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;This is still alive! &lt;a href=&quot;https://wasabigeek.github.io/drumz/&quot;&gt;https://wasabigeek.github.io/drumz/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Me being a very lazy drummer, just want to be given some licks to practice instead of having to orchestrate and build patterns up to speed myself&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Built a small, limited prototype (only 4/4, only 16th notes 1 bar fill) then tried to do some validation&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Posted on Reddit r/drums, relatively speaking there was very little interest (few upvotes and comments compared to what seems to usually trend there)&lt;/li&gt;
&lt;li&gt;Pinged 3 musician friends - feedback was more in the “oh this is cool” sorta vein (I need to dig up those messages)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Made some upgrades (the biggest being multiple usages: part-bar, 1-bar, 1-bar 16th note triplets variations)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I used Vexflow and WebAudio, which was really interesting&lt;/li&gt;
&lt;li&gt;r/drums might not be the right subreddit, given the focus there seems to be showing off 😋  maybe I should try r/drumming (which has less people but seems more educational) or see if there are some groups / chats I can join to talk with people&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Aug 2020&lt;/h2&gt;
&lt;h3&gt;HabitStar&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;I never made it to releasing on the App Store, but some screens of the prototype still exist on &lt;a href=&quot;https://getmakerlog.com/tasks/305538&quot;&gt;Makerlog&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The thought process was something like, I’ve always wanted to try to build a mobile app + mobile apps seem to make a nice indie hacker project (could push infra to Apple via saving on device/iCloud, so it sounded like it’d be easier for one person to maintain than a web app)&lt;/li&gt;
&lt;li&gt;Initially thought to convert Over the Kit to an app, but after working with and digging into React Native for a bit, it seemed like it would be a challenge (due to Javascript’s event loop), so I thought I’d start with something simpler&lt;/li&gt;
&lt;li&gt;I always wanted to make a habit tracker, because the one I was using still felt a little clunky&lt;/li&gt;
&lt;li&gt;Got a little bogged down trying to (i.) make a design I liked; (ii.) figure out the gamification mechanics (which I wanted to have in order to differentiate it). My lack of experience around mobile development and React Native (data storage, testing and debugging) made the experience slow and frustrating at times as well.&lt;/li&gt;
&lt;li&gt;At one point I was wondering whether to set the gamification part aside for a bit to just focus on getting the app out. But I thought the gamification was part of the charm, and didn’t want to release without it (the $99 developer fee also was a small discourager)&lt;/li&gt;
&lt;li&gt;In the end, I just drifted to something else…&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The design part especially seemed to bog me down mentally (“I wish it looked better”). Maybe I shouldn’t let myself get too discouraged with a sub-standard design. Or maybe I should try to get more comfortable with design?&lt;/li&gt;
&lt;li&gt;I’m sure the “slow and frustrating” feeling contributed to me drifting away - but I should actually try to get used to being in that zone more, because it probably means I’m doing something way out of my comfort zone and learning something new.&lt;/li&gt;
&lt;li&gt;I finally got to try React Native after thinking about it for years, so that was great! I do wonder if the tooling around Flutter is better though, maybe will give that a bit of a try. If it leans towards the game aspects more too, I wonder if I should try something like Unity 🤔  All of the above sound like pretty significant time commitments.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Aug/Oct 2020&lt;/h2&gt;
&lt;h3&gt;ClassCal&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Still a work in progress, there’s a &lt;a href=&quot;https://classcal-staging.herokuapp.com/&quot;&gt;staging app&lt;/a&gt; you can try, plus a quick and dirty wix landing page my friend made &lt;a href=&quot;https://www.classcal.com/&quot;&gt;https://www.classcal.com/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Discussed a few ideas with a friend before we decided to give a Tuition scheduling app a try, based on some earlier conversations he had while validating a different idea. For me, I was also curious about whether we could work together, since he had some experiences starting more traditional businesses, and seemed to be stronger in the sales aspect.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In terms of validating the idea:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;my friend did some demos with existing solutions in the market - we thought a possible angle was to try to do something more affordable and SaaS-like, since the incumbent solutions in the market were positioned more as custom solutions, with prices to match (though they could qualify for the govt. grants)&lt;/li&gt;
&lt;li&gt;we spoke with 2 of his contacts in the industry, the second one was positive but also seemed to have a non-traditional approach to the business, managing it more like a gym with online bookings and payments&lt;/li&gt;
&lt;li&gt;we tried to walk the ground and speak with some tuition centres, but this was super hard. Most people just shoo-ed us away (to be fair, it was true that they were busy)&lt;/li&gt;
&lt;li&gt;my friend also tried to post a poll in a Facebook groups, there was little response&lt;/li&gt;
&lt;li&gt;now we’re trying Google Ads with the landing page in a last-ditch attempt to get people to talk to and learn from, before we decide whether to move on to a different idea&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;We agreed not to build anything beyond a Figma prototype until we had more validation, but I had itchy fingers by October and went to start on the app. It was a nice chance for me to figure out how to build a SaaS in Rails as well (I had tried some out-of-the-box template with the newsletter idea but it was not well-documented and I didn’t know enough / need all of the bells and whistles)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I think it’s worth spending time aligning with a partner on approaches and beliefs. Personally,  I realised I didn’t really know how to explain processes I had taken for granted, such as user story mapping.&lt;/li&gt;
&lt;li&gt;It was helpful having the second brain, we weren’t always on the same wavelength but it did push me to have a different perspective and read up stuff I’ve been putting off e.g. on validation&lt;/li&gt;
&lt;li&gt;I think I will still continue building for a bit, because it does provide a potential future framework for launching other projects. In the worst case, I will open source it and try to do some walkthrough to building a SaaS in Rails.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Sep 2020&lt;/h2&gt;
&lt;h3&gt;PeekPalette&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The unfinished &lt;a href=&quot;https://wasabigeek.github.io/peekpalette/&quot;&gt;landing page&lt;/a&gt; is still up&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;While doing the Figma prototype, I spent quite a bit of time figuring out colour variations and thought, there must be an opportunity here - an app that would generate and let you preview colour combinations against a UI (something like Headlime, but for UI colour palettes)&lt;/li&gt;
&lt;li&gt;I decided to try starting from a landing page and validate that first. After spending a week on an interactive hero section, I realised I didn’t know what else to put in the “marketing” section of the site that would be convincing &gt;_&amp;#x3C;&lt;/li&gt;
&lt;li&gt;In terms of validation, I did a half-hearted post on Makerlog and another on IndieHackers, again, very little feedback or interest.&lt;/li&gt;
&lt;li&gt;Also thought that the target might be so niche it didn’t exist: If I’m a dev that wasn’t good with design, I’d probably purchase some theme instead.&lt;/li&gt;
&lt;li&gt;I do think there’s some opportunity in this market, but this probably wouldn’t cut it as a standalone product&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I did enjoy working on the hero section, got to try out a rainbow CSS gradient I saw on another blog&lt;/li&gt;
&lt;li&gt;I didn’t enjoy trying to figure out the design of the UI on the interactive element, and also figuring out the marketing copy. That’s also probably the point when I started to realise the idea didn’t have legs. In this case, might have been helpful to validate more first before building, but I think I did ok here, didn’t “waste” too much time.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Dec 2020&lt;/h2&gt;
&lt;h3&gt;BaseUI (working title)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Continuing the theme of “I wish there was an easier way to do a nice design”, I’m currently trying to validate whether my problem of getting a decent but still unique design done quickly applies to other IH devs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Inspired by the Mom Test, I tried not to rush into building, but tried to understand the target’s (IH devs) current workflow a bit more with a post on IH &lt;a href=&quot;https://www.indiehackers.com/post/serial-saas-devs-whats-your-workflow-when-starting-a-new-project-7d4c43a2a3&quot;&gt;https://www.indiehackers.com/post/serial-saas-devs-whats-your-workflow-when-starting-a-new-project-7d4c43a2a3&lt;/a&gt; (it was also useful for me)&lt;/li&gt;
&lt;li&gt;I looked at other solutions in the market: full-app templates like JumpstartPro and pure UI component libraries like TailwindUI, thought there might be an opportunity to do something in the middle.&lt;/li&gt;
&lt;li&gt;I’m now trying to build (oops) a &lt;a href=&quot;https://github.com/wasabigeek/rails-templates/tree/main/base_ui&quot;&gt;free, minimal set of components&lt;/a&gt; that’s integrated with Rails, and seeing whether there’s interest in that before going further. Again, struggling a little with design here (I would love to just plonk TailwindUI in there, but it goes against their license, and I’m not sure if there’s a cheap way to get a neat set of components)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Customising Generator Templates in Rails (Gems too!)]]></title><description><![CDATA[Rails’ generators are a great boon to the Indie HackerTM or Solo DeveloperTM. Running  will quickly bootstrap the full stack for a model…]]></description><link>https://www.wasabigeek.com/blog/customising-generator-templates-in-rails-gems-too/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/customising-generator-templates-in-rails-gems-too/</guid><pubDate>Sat, 07 Nov 2020 20:32:03 GMT</pubDate><content:encoded>&lt;p&gt;Rails’ generators are a great boon to the Indie Hacker&lt;sup&gt;TM&lt;/sup&gt; or Solo Developer&lt;sup&gt;TM&lt;/sup&gt;. Running &lt;code class=&quot;language-text&quot;&gt;rails g scaffold ...&lt;/code&gt; will quickly bootstrap the full stack for a model, creating the routes, controllers, views and even tests.&lt;/p&gt;
&lt;p&gt;As you start customising and standardising your interface though, the default templates get less and less useful - most of the generated code doesn’t fit your layout or setup, and you end up deleting most of it or skipping them.&lt;/p&gt;
&lt;h2&gt;What if we could change the… templates?&lt;/h2&gt;
&lt;p&gt;Rails actually gives you a lot of &lt;a href=&quot;https://guides.rubyonrails.org/generators.html&quot;&gt;control&lt;/a&gt; over the generators, but early on in a project, perhaps the most impactful &lt;em&gt;and&lt;/em&gt; simple thing to do is to override the &lt;a href=&quot;https://guides.rubyonrails.org/generators.html#customizing-your-workflow-by-changing-generators-templates&quot;&gt;templates&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Let’s look at an example. Normally Rails would generate a &lt;code class=&quot;language-text&quot;&gt;show.html&lt;/code&gt; that looks something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;erb&quot;&gt;&lt;pre class=&quot;language-erb&quot;&gt;&lt;code class=&quot;language-erb&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;notice&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; notice &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;strong&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Attribute:&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;strong&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token variable&quot;&gt;@object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attribute &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; link_to &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Edit&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; edit_object_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt; |
&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; link_to &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Back&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; object_path &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For a personal project, I’ve made mine generate something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;erb&quot;&gt;&lt;pre class=&quot;language-erb&quot;&gt;&lt;code class=&quot;language-erb&quot;&gt;&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; content_for &lt;span class=&quot;token symbol&quot;&gt;:breadcrumbs&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;...&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    Home &gt; &lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token variable&quot;&gt;@object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attribute &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; content_for &lt;span class=&quot;token symbol&quot;&gt;:heading&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;...&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;...&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token variable&quot;&gt;@object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; link_to &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Edit object&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; edit_object_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;...&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; content_for &lt;span class=&quot;token symbol&quot;&gt;:main_content&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;...&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token variable&quot;&gt;@object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attribute &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt;&lt;span class=&quot;token ruby language-ruby&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s saved me a lot of time!&lt;/p&gt;
&lt;p&gt;To do so, simply add a template to your Rails project in &lt;code class=&quot;language-text&quot;&gt;lib/templates/erb/scaffold/show.html.erb&lt;/code&gt;. You can use the &lt;a href=&quot;https://github.com/rails/rails/blob/master/railties/lib/rails/generators/erb/scaffold/templates/show.html.erb.tt&quot;&gt;original&lt;/a&gt; as a starting point. The other templates can also be easily changed following a similar path. Note the double percentages (&lt;code class=&quot;language-text&quot;&gt;%%&lt;/code&gt;) used to escape ERB tags!&lt;/p&gt;
&lt;h2&gt;Bonus: Gems too!&lt;/h2&gt;
&lt;p&gt;This also works for your gems that have generators (e.g. &lt;a href=&quot;https://github.com/rspec/rspec-rails&quot;&gt;rspec-rails&lt;/a&gt; or &lt;a href=&quot;https://github.com/reactjs/react-rails&quot;&gt;react-rails&lt;/a&gt;), though it’s not obvious where to place the templates.&lt;/p&gt;
&lt;p&gt;Our answer lies in &lt;a href=&quot;https://github.com/rails/rails/blob/master/railties/lib/rails/generators/base.rb&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Rails::Generators::Base.inherited&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;inherited&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#:nodoc:&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
  Rails&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;Generators&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;templates_path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;path&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;::&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source_paths &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;generator_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
      base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source_paths &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;generator_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So, in addition to the &lt;code class=&quot;language-text&quot;&gt;source_root&lt;/code&gt; that most Generators would define, Rails will also search a few extra paths. In general, you should place the template in &lt;code class=&quot;language-text&quot;&gt;lib/templates/&amp;lt;top_level_module&gt;/&amp;lt;generator_class_prefix&gt;/&amp;lt;template_name&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For example, &lt;code class=&quot;language-text&quot;&gt;react-rails&lt;/code&gt; has &lt;a href=&quot;https://github.com/reactjs/react-rails/blob/master/lib/generators/react/component_generator.rb&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;React::Generators::ComponentGenerator&lt;/code&gt;&lt;/a&gt;, so if I wanted to replace &lt;a href=&quot;https://github.com/reactjs/react-rails/blob/master/lib/generators/templates/component.es6.jsx&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;component.es6.jsx&lt;/code&gt;&lt;/a&gt;, I would place it in &lt;code class=&quot;language-text&quot;&gt;lib/templates/react/component/component.es6.jsx&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I hope that helps!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[First Steps into Open Source]]></title><description><![CDATA[At start of the year, I set a rather nebulous goal: “become a regular open source contributor” The motivation was to experience different…]]></description><link>https://www.wasabigeek.com/blog/first-steps-to-open-source/</link><guid isPermaLink="false">https://www.wasabigeek.com/blog/first-steps-to-open-source/</guid><pubDate>Wed, 06 May 2020 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;At start of the year, I set a rather nebulous goal:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“become a regular open source contributor”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The motivation was to experience different codebases to gain more experience and (hopefully) improve my employability. 5 months on, I feel reasonably comfortable stating that I’m an open source contributor, and hope to continue doing so.&lt;/p&gt;
&lt;p&gt;This is a summary of my journey so far, I hope it’ll be useful for you, especially if you’re thinking of contributing!&lt;/p&gt;
&lt;h2&gt;First Timers Only&lt;/h2&gt;
&lt;p&gt;To start, I remembered reading about a &lt;a href=&quot;https://kentcdodds.com/blog/first-timers-only&quot;&gt;first timers “movement”&lt;/a&gt; and quickly found a compilation of participating &lt;a href=&quot;https://github.com/MunGell/awesome-for-beginners&quot;&gt;projects&lt;/a&gt;. Ruby was what we used at work, so I jumped to that section.&lt;/p&gt;
&lt;p&gt;The first &lt;a href=&quot;https://github.com/rails/rails/pull/38220&quot;&gt;PR&lt;/a&gt; I tried to submit was for Rails (seemed like it would be something nice on the resume). Rails uses the label &lt;a href=&quot;https://github.com/rails/rails/labels/good%20first%20issue&quot;&gt;good first issue&lt;/a&gt;, so I picked an issue near the top, spent a Saturday working and submitted it!&lt;/p&gt;
&lt;p&gt;Then I waited.&lt;/p&gt;
&lt;p&gt;And waited.&lt;/p&gt;
&lt;h2&gt;Good things…&lt;/h2&gt;
&lt;p&gt;In hindsight, that issue was not a great first pick. It already had some attempts, with the most recent just a week before my PR. I think I was so unsure of myself, I figured this would be a super low-risk issue to try. After all, if I screwed it up, there were other attempts that could be picked up.&lt;/p&gt;
&lt;p&gt;In the end, one of the maintainers took it upon himself to close the issue and credited all the contributors. His PR was better, but I guess it was mainly a way of navigating this long-drawn issue without stepping on any toes.&lt;/p&gt;
&lt;p&gt;While waiting, I decided to try again. We were using a &lt;a href=&quot;https://github.com/99designs/iamy&quot;&gt;tool&lt;/a&gt; written in Go to manage our AWS IAM at work, but there was a good-to-have feature we wanted and an issue for it. So I spent a few week nights and weekends learning Go, doing up the &lt;a href=&quot;https://github.com/99designs/iamy/pull/69&quot;&gt;PR&lt;/a&gt; and submitting it.&lt;/p&gt;
&lt;p&gt;Then I waited.&lt;/p&gt;
&lt;h2&gt;…come to those…&lt;/h2&gt;
&lt;p&gt;And someone reviewed! I was energised. I made some changes.&lt;/p&gt;
&lt;p&gt;Then he requested a second opinion from another maintainer.&lt;/p&gt;
&lt;p&gt;It’s still there, open.&lt;/p&gt;
&lt;p&gt;At this point I was starting to get disheartened. (No hate to open source maintainers, it’s pretty thankless work and the world is better for your contributions.)&lt;/p&gt;
&lt;h2&gt;…who &lt;del&gt;wait&lt;/del&gt; keep trying.&lt;/h2&gt;
&lt;p&gt;I flapped around a bit, and one day decided to look at another gem our company had been using. I saw a pretty steady stream of merges, neatly labelled issues, plus it just felt less intimidating than Rails.&lt;/p&gt;
&lt;p&gt;A few days later, my &lt;a href=&quot;https://github.com/slack-ruby/slack-ruby-bot/pull/244&quot;&gt;first merge&lt;/a&gt;! I was elated.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 518px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a6a8e9110ff40b0c37628a8d0267e82e/6b9fd/slackrubymerge.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.18918918918919%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAh0lEQVQI16XOTQ6CMBiEYe6/9hqehg0JxmAQCm0JPwbs15+8huoNnOTJbGYxxdjuBBHkJ8aI9z6TkwjOOZwTQoj4kPC5v859OPfiSSlRXC836rKkrirq252uV6hhxBiLNhalBprmQdf1TPOLp92zVm/Zsu1MdkJrk08UXiLH8WZe1mxZN/7JBzMq5yu8m2zxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;First Merge!&quot;
        title=&quot;First Merge!&quot;
        src=&quot;/static/a6a8e9110ff40b0c37628a8d0267e82e/6b9fd/slackrubymerge.png&quot;
        srcset=&quot;/static/a6a8e9110ff40b0c37628a8d0267e82e/12f09/slackrubymerge.png 148w,
/static/a6a8e9110ff40b0c37628a8d0267e82e/e4a3f/slackrubymerge.png 295w,
/static/a6a8e9110ff40b0c37628a8d0267e82e/6b9fd/slackrubymerge.png 518w&quot;
        sizes=&quot;(max-width: 518px) 100vw, 518px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Huge props to &lt;a href=&quot;https://github.com/dblock&quot;&gt;dblock&lt;/a&gt;, who somehow manages to turnaround and reply quickly, often within a day or two. Rubyists, if you would love to contribute but don’t know where to, might I humbly suggest anyone of dblock’s projects - it’s a great place to start.&lt;/p&gt;
&lt;h2&gt;Closing Thoughts&lt;/h2&gt;
&lt;p&gt;For “first timers” looking to contribute, my takeaways (sample size of 1, take with a pinch of salt):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Labels on recent issues seemed like a good sign that a project is well-maintained. Search for a &lt;code class=&quot;language-text&quot;&gt;first-timers-only&lt;/code&gt; type label - for example, in Rails it was &lt;code class=&quot;language-text&quot;&gt;good first issue&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Check the &lt;code class=&quot;language-text&quot;&gt;CONTRIBUTING.md&lt;/code&gt; documentation first before starting on your PR! There’s usually a lot of helpful setup stuff there. For example, Rails was pretty amazing for this, I was kinda worried going in but it was really smooth, they even had instructions on how to use Vagrant to get started.&lt;/li&gt;
&lt;li&gt;Expect a little trial-and-error to getting your first PR merged, but stick with it! I found the experience super rewarding, and indeed got exposure to different codebases and languages.&lt;/li&gt;
&lt;li&gt;Make life as easy for maintainers as possible - try to figure out as much as you can first, whether it’s looking at previous PRs, making GitHub checks pass.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I hope that was helpful! Feel free to drop a note on Twitter to discuss / disagree :)&lt;/p&gt;</content:encoded></item></channel></rss>