{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/blog/window-function-calls-an-introduction/",
    "result": {"data":{"site":{"siteMetadata":{"title":"wasabigeek"}},"markdownRemark":{"id":"fef023c8-bbfd-5953-acfc-547a1dd96c36","excerpt":"What is a window function call? My explanation: adds a column to query results that is calculated based on other rows in the table Ok, that’s probably still not…","html":"<p>What is a <strong>window function call</strong>? My explanation:</p>\n<blockquote>\n<p>adds a column to query results that is calculated based on other rows in the table</p>\n</blockquote>\n<p>Ok, that’s probably still not immediately understandable, so let’s walk through an example. Imagine you’ve been tracking expenses in Postgres:</p>\n<table>\n<thead>\n<tr>\n<th>description</th>\n<th>category</th>\n<th>created_at</th>\n<th>cost</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bus ride</td>\n<td>transport</td>\n<td>2020-01-01</td>\n<td>3</td>\n</tr>\n<tr>\n<td>lunch</td>\n<td>food &#x26; drinks</td>\n<td>2020-01-01</td>\n<td>15</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>Now, say you wanted to see how much each expense compares to the average:</p>\n<table>\n<thead>\n<tr>\n<th>description</th>\n<th>category</th>\n<th>created_at</th>\n<th>cost</th>\n<th>avg</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bus ride</td>\n<td>…</td>\n<td>…</td>\n<td>3</td>\n<td>17.5</td>\n</tr>\n<tr>\n<td>lunch</td>\n<td>…</td>\n<td>…</td>\n<td>15</td>\n<td>17.5</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>You <em>could</em> use a subquery to calculate the average:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> <span class=\"token function\">avg</span><span class=\"token punctuation\">(</span>cost<span class=\"token punctuation\">)</span> <span class=\"token keyword\">from</span> expenses<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> expenses<span class=\"token punctuation\">;</span></code></pre></div>\n<p>But we could also be a little fancier and use a window function call:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> <span class=\"token function\">avg</span><span class=\"token punctuation\">(</span>cost<span class=\"token punctuation\">)</span> <span class=\"token keyword\">over</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> expenses<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Although we have some new syntax to understand (which we’ll get into later), that’s noticeably shorter! What just happened?</p>\n<h2 id=\"hello-window-frames\" style=\"position:relative;\"><a href=\"#hello-window-frames\" aria-label=\"hello window frames permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hello, Window Frames</h2>\n<p>Let’s try to visualise the window function call. For each row, Postgres calculates the average cost of the rest of the table, which is the default <strong>“window frame”</strong>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1014b18a4b3fbfc949cb36a9403672a2/2bef9/avg_cost_whole_table.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACC0lEQVQoz4VS21LbMBDl//+lj32jT71AKSTAYIc4diCO5Ztk3ezYkixpO3ZgEjqd9owedkd79uwe6cIDeJjgnPfHCMB7MGacjxnH0QNY55TSczYqpay1AHBxrLbOaT3gKmcUFyhtSOWt9lY7a4zRuK6EEN2ha5qmqmtKWdd1E7lTkJSwzkZMu7tg/3MZXy82yyAtqcmwRiVH8dPy+uv6/ga9bFBJovVqvQqEEBOZd7DYQsn81bN5LXpExmQvawEZNohBnWdNme9rTRoRrxOSrkDtR4k4l29je4CbyF3eTzovSDys9hV3JYOMwq5oi13y9KpiNERBIDoNfWZJSHk7kd8N81skUzzmeMBciR56DXoE67wjT8Z6a123vx2UAsNt+qVpyEkZAKRgnWRJHDFGZ8P9m+8sJIQw0R7KVc/Q5K5Im/Tx5DYACCGMMcf6M3igwbFRmwc9TSey6kj87V15vmOMbbfbMAwZY2dcDzTcRFFeEdNsRJUAwKgPePPjT2Xn3GngM+W+PyjjvNxRFM2/YsDxlR7dB7Ke4c9grRvQHRet7N2hCHbPtzUfyOui2D4ae6aslOKcCyH4CUwyPKBFv/veZ79U/FkWq1YKVT54qz+M/XcoAvIFkk+A7yC7BLKAPgcR+3m9f5DnzY2E8gYGAqaFeulp6BXzVh0r/qfsLTQh9PUUjN3U4uwxfwPYyFhU/HYWBQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Calculating average cost over the default window frame\"\n        title=\"Calculating average cost over the default window frame\"\n        src=\"/static/1014b18a4b3fbfc949cb36a9403672a2/fcda8/avg_cost_whole_table.png\"\n        srcset=\"/static/1014b18a4b3fbfc949cb36a9403672a2/12f09/avg_cost_whole_table.png 148w,\n/static/1014b18a4b3fbfc949cb36a9403672a2/e4a3f/avg_cost_whole_table.png 295w,\n/static/1014b18a4b3fbfc949cb36a9403672a2/fcda8/avg_cost_whole_table.png 590w,\n/static/1014b18a4b3fbfc949cb36a9403672a2/efc66/avg_cost_whole_table.png 885w,\n/static/1014b18a4b3fbfc949cb36a9403672a2/2bef9/avg_cost_whole_table.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now if that was all you could do with window function calls, I’d be disappointed too. Thankfully, it’s not! Aside from being shorter, there are some key features that are harder to replicate with subqueries:</p>\n<ul>\n<li>calculations can be done over a subset of the table (i.e. a smaller <strong>window frame</strong>) instead of the whole table</li>\n<li>in addition to the usual aggregation functions like <code class=\"language-text\">avg</code> or <code class=\"language-text\">max</code>, there are <strong>window functions</strong>, which can only be used as part of a window function call</li>\n</ul>\n<h2 id=\"reframing-the-window\" style=\"position:relative;\"><a href=\"#reframing-the-window\" aria-label=\"reframing the window permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reframing the Window</h2>\n<p>Let’s try calculating over a subset. Knowing the average across all expenses wasn’t very helpful - a big purchase could skew the calculation, so let’s instead compare each expense to the <em>category average</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> <span class=\"token function\">avg</span><span class=\"token punctuation\">(</span>cost<span class=\"token punctuation\">)</span> <span class=\"token keyword\">over</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">partition</span> <span class=\"token keyword\">by</span> category<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token string\">\"avg in category\"</span>\n<span class=\"token keyword\">from</span> expenses<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Our result now looks something like:</p>\n<table>\n<thead>\n<tr>\n<th>description</th>\n<th>category</th>\n<th>created_at</th>\n<th>cost</th>\n<th>avg in category</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>tea break</td>\n<td>food &#x26; drinks</td>\n<td>…</td>\n<td>5</td>\n<td>24</td>\n</tr>\n<tr>\n<td>lunch</td>\n<td>food &#x26; drinks</td>\n<td>…</td>\n<td>15</td>\n<td>24</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>taxi to home</td>\n<td>transport</td>\n<td>…</td>\n<td>20</td>\n<td>7.5</td>\n</tr>\n<tr>\n<td>bus ride home</td>\n<td>transport</td>\n<td>…</td>\n<td>3</td>\n<td>7.5</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>That’s a bit more helpful! Let’s visualise this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6107b4b5b64a472d789accb94501592f/2bef9/avg_cost_category.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7ElEQVQoz3WTW3PbIBCF/f//Uh97SWZS59qxU0uqLaxIsi4IkAUIAaeDlKStJ93hgRn2A87Z3RUA7/G/8N4tG6WU1hqAtXaQciFWAPSEXoH34/5Yx4e8bM7aoHwhm4d1vH2k1Quvy6f7h8fbG8FZXZWP62vaVAGWI653uEkQ5/ZY8IS0x0oJIUl6jNLmZ1K8VOeWGznaffyLMwFDbfbF0jjA1qHiiAo8Z5bkLCYsq0cqTE7S9fe7ZBc3VdNWVbpPs+iHnUYYAbpZJK3e5VnrU5LVdeM9nIOz5nSqlFTee+ecktKYoBnmDLr9A3uPxYBpMs7Z+cDBKj+dnWq8aqBbI/KxTeAMvAXfL26u/jLWc877vhf9gKlXTbKPttHmTrEcEzuRXZeuYYeQKlJY/er2Es45xtgwDOdhCC8Mhe0Lp1sYBtV61UI3cNMME0zyH3jhrbXOhdqa7iCKZ5ptebGDqsaOTDSCm2WLQ/j8xcuU0rIsy1MFb8Y2btouSWJKKYBejrqJYHjAWHTp9gKzrqvrGoAsnwhJo10keAd4zsWQ3cKeMXL06SUcACm11uO4/C319b3NPiP/CvIpLJYEsnsOjry354dNPTd0i/IKYo/iG4oryDqonX3+APbziPj3QXEj2g2m2fxQ4ent3teE36FvI2lX/+ssAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Calculating average cost over each category\"\n        title=\"Calculating average cost over each category\"\n        src=\"/static/6107b4b5b64a472d789accb94501592f/fcda8/avg_cost_category.png\"\n        srcset=\"/static/6107b4b5b64a472d789accb94501592f/12f09/avg_cost_category.png 148w,\n/static/6107b4b5b64a472d789accb94501592f/e4a3f/avg_cost_category.png 295w,\n/static/6107b4b5b64a472d789accb94501592f/fcda8/avg_cost_category.png 590w,\n/static/6107b4b5b64a472d789accb94501592f/efc66/avg_cost_category.png 885w,\n/static/6107b4b5b64a472d789accb94501592f/2bef9/avg_cost_category.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>For each row, our new window frame includes only other rows with the same category, and the average is calculated based on those rows.</p>\n<p>This is also a good time to take a brief look at the syntax we’ve used so far:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> <span class=\"token function\">avg</span><span class=\"token punctuation\">(</span>cost<span class=\"token punctuation\">)</span> <span class=\"token keyword\">OVER</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> category<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>In the above:</p>\n<ul>\n<li><code class=\"language-text\">avg(cost)</code> is the aggregation function that we want to execute over the window frame - we could use other functions such as <code class=\"language-text\">max</code> or <code class=\"language-text\">min</code></li>\n<li><code class=\"language-text\">OVER</code> is the keyword which tells Postgres we were using a window function call. Everything in parentheses specifies how our table will be divided into different window frames</li>\n<li>in this case, we are using <code class=\"language-text\">PARTITION BY category</code>, which means we are dividing the table into different window frames based on their category</li>\n</ul>\n<h2 id=\"window-functions\" style=\"position:relative;\"><a href=\"#window-functions\" aria-label=\"window functions permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Window Functions</h2>\n<p>Now that we know a little more about the syntax, let’s look at the other hidden power of window functions calls… <strong>window functions</strong> themselves!</p>\n<p>It’s coming to the end of the month, and you want to know the biggest expense in each category, for each day. There’s a window function for that - <code class=\"language-text\">rank</code>!</p>\n<p>With <code class=\"language-text\">rank</code>, we can calculate the order of each row in it’s window frame (Note that the following query still returns every row in the table, not just the top expenses - we’ll fix that later):</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span>\n  <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span>\n  rank<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">over</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">partition</span> <span class=\"token keyword\">by</span> category<span class=\"token punctuation\">,</span> created_at\n    <span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> cost <span class=\"token keyword\">desc</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> expenses<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notice the additional syntax in our window function call:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">OVER</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> category<span class=\"token punctuation\">,</span> created_at <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> cost <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<ul>\n<li>we’ve added a second condition to <code class=\"language-text\">PARTITION BY</code> to further divide each window frame by the day each entry was <code class=\"language-text\">created_at</code> (this is very similar to <code class=\"language-text\">GROUP BY</code>)</li>\n<li>there’s now an <code class=\"language-text\">ORDER BY ... DESC</code> that orders the rows within each frame from highest to lowest cost, so we’ll know that a rank of 1 would be the most expensive</li>\n</ul>\n<p>Another quick visual:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c2273fb3c2a5f6a4d8b43e62292fa544/2bef9/rank_category_date.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVQoz42RW1PbMBCF/f//EjNkmE65NASIY6zmYohlR3FiI182kkxk7XYcp9DpC5ynndV+OjorD+lrdc4RkVLKOYeITdNorYnIIyJrj1odqqo0xlDXFuli8/rcyJyv47vr69CfxtECCsHuL6vstYEDC8M0TXvYjyna6HEgRjfze7aP+fb26uJy9HMeMpFwFgRPk0n0IqIExtN1svCNMWbHjFZI5P1gtBQYrpW/kizWItfs4XYyfoxXK7nbCh4ny1DyoEpm5frhWPI+Bp6zeuZItSJC13Vd39c5lqs2X74XS6xedBbCdu7Ultq9THxbRuQ6hPREozdcIoSoyrJvwEbyIHr+BbsFKd7mv0GEruYOUhAzhD4qvddn5wF27uxMzvbm7RsdgdBZa12/6n5Ka2Wt/fcXvIEEgKIopJSIlG52T9NgX7wRkZQyy7KBUUqdDQg/YUQEgLqulVJEZIw+AOBpAk+iv6/7qD/hQf8dfEd/ACYyOMjX6E9NAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Calculating rank over each category and date\"\n        title=\"Calculating rank over each category and date\"\n        src=\"/static/c2273fb3c2a5f6a4d8b43e62292fa544/fcda8/rank_category_date.png\"\n        srcset=\"/static/c2273fb3c2a5f6a4d8b43e62292fa544/12f09/rank_category_date.png 148w,\n/static/c2273fb3c2a5f6a4d8b43e62292fa544/e4a3f/rank_category_date.png 295w,\n/static/c2273fb3c2a5f6a4d8b43e62292fa544/fcda8/rank_category_date.png 590w,\n/static/c2273fb3c2a5f6a4d8b43e62292fa544/efc66/rank_category_date.png 885w,\n/static/c2273fb3c2a5f6a4d8b43e62292fa544/2bef9/rank_category_date.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>So for each row, our window frame is other rows with the same category and created_at date, and we order the rows from highest to lowest cost.</p>\n<p>The query gives us a result like:</p>\n<table>\n<thead>\n<tr>\n<th>description</th>\n<th>category</th>\n<th>created_at</th>\n<th>cost</th>\n<th>rank</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>groceries</td>\n<td>food &#x26; drinks</td>\n<td>2020-01-01</td>\n<td>60</td>\n<td>1</td>\n</tr>\n<tr>\n<td>dinner</td>\n<td>food &#x26; drinks</td>\n<td>2020-01-01</td>\n<td>35</td>\n<td>2</td>\n</tr>\n<tr>\n<td>lunch</td>\n<td>food &#x26; drinks</td>\n<td>2020-01-01</td>\n<td>15</td>\n<td>3</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>taxi</td>\n<td>transport</td>\n<td>2020-01-01</td>\n<td>20</td>\n<td>1</td>\n</tr>\n<tr>\n<td>bus ride</td>\n<td>transport</td>\n<td>2020-01-01</td>\n<td>3</td>\n<td>2</td>\n</tr>\n<tr>\n<td>bus ride</td>\n<td>transport</td>\n<td>2020-01-02</td>\n<td>4</td>\n<td>1</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>Now that we have a ranking, we could use it as a subquery and filter out expenses that are rank 2 or higher.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">-- our earlier query</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token string\">\"ranked_expenses\"</span>\n<span class=\"token keyword\">where</span> rank <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Which leaves us with exactly what we want - nice!</p>\n<table>\n<thead>\n<tr>\n<th>description</th>\n<th>category</th>\n<th>created_at</th>\n<th>cost</th>\n<th>rank</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>groceries</td>\n<td>food &#x26; drinks</td>\n<td>2020-01-01</td>\n<td>60</td>\n<td>1</td>\n</tr>\n<tr>\n<td>lunch</td>\n<td>food &#x26; drinks</td>\n<td>2020-01-02</td>\n<td>15</td>\n<td>1</td>\n</tr>\n<tr>\n<td>taxi to home</td>\n<td>transport</td>\n<td>2020-01-01</td>\n<td>20</td>\n<td>1</td>\n</tr>\n<tr>\n<td>bus ride home</td>\n<td>transport</td>\n<td>2020-01-02</td>\n<td>4</td>\n<td>1</td>\n</tr>\n<tr>\n<td>…</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>I hoped that helped you grok window functions! If you want to play around with the data in this example, there’s an <a href=\"http://sqlfiddle.com/#!17/f33e78/3\">sqlfiddle</a> - in case that doesn’t exist at the time of reading, you can also get the SQL to create the table and query the data from this <a href=\"https://gist.github.com/wasabigeek/2b9fb05eba5c26928bab85bcf408511f\">gist</a>.</p>\n<p>In the next few articles, we’ll look into the individual window functions, starting with those for <a href=\"/blog/window-functions-visualised-rankings/\">ranking rows</a>.</p>","frontmatter":{"title":"Window Function Calls in Postgres - A Visual Introduction","date":"December 31, 2020","description":"What is a Window Function Calls? The why and the how, explained with pictures for maximum grok-ability."}},"allMarkdownRemark":{"edges":[{"node":{"excerpt":"If you’re trying to get more productive at writing or content creation (especially long-form), I highly recommend checking out How to take…","fields":{"slug":"/blog/zettelkasten-and-how-to-take-smart-notes/"},"frontmatter":{"date":"April 16, 2022","title":"Zettelkasten from \"How to take Smart Notes\"","description":"A review and summary of 'How to take Smart Notes' and the Zettelkasten process described within. I think of it as purposeful note-taking, used to generate ideas for writing or content creation."}}},{"node":{"excerpt":"When I first came across the concept of Polymorphism in Object-Oriented Programming (OOP), it wasn’t obvious to me why it was important. The…","fields":{"slug":"/blog/why-is-polymorphism-important/"},"frontmatter":{"date":"March 20, 2022","title":"Why use Polymorphism in OOP?","description":"Polymorphism in Object-Oriented Programming, while abstract, is still somewhat easy to understand. Why we should use it, though, is less obvious. Let's investigate polymorphism's benefits!"}}},{"node":{"excerpt":"”A class should only have one reason to change” is a mantra that Object-Oriented advocates have chanted for years. Dubbed the “Single…","fields":{"slug":"/blog/what-does-a-1972-paper-have-to-do-with-the-single-responsibility-principle/"},"frontmatter":{"date":"February 28, 2022","title":"A 1972 paper and the Single Responsibility Principle","description":"While trying to explain the Single Responsibility Principle, it's originator calls attention to the paper 'On the Criteria To Be Used in Decomposing Systems into Modules'. Why was this paper so significant? Let's find out!"}}}]}},"pageContext":{"slug":"/blog/window-function-calls-an-introduction/","previous":{"fields":{"slug":"/blog/2020-in-retrospect-making/"},"frontmatter":{"title":"2020 in Retrospect: Making","tags":null}},"next":{"fields":{"slug":"/blog/window-functions-visualised-rankings/"},"frontmatter":{"title":"Window Functions, Visualised - Rankings","tags":["postgres","window-functions"]}},"relatedPosts":[{"node":{"fields":{"slug":"/blog/meta-postgres-what-constraints-does-a-table-have/"},"frontmatter":{"title":"Meta-Postgres: What constraints does a table have?","tags":["postgres"]}}},{"node":{"fields":{"slug":"/blog/window-functions-visualised-rankings/"},"frontmatter":{"title":"Window Functions, Visualised - Rankings","tags":["postgres","window-functions"]}}}]}},
    "staticQueryHashes": ["2744205926","2841359383"]}