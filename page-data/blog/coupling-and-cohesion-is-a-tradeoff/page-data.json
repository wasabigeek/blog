{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/blog/coupling-and-cohesion-is-a-tradeoff/",
    "result": {"data":{"site":{"siteMetadata":{"title":"wasabigeek"}},"markdownRemark":{"id":"0485268e-11f0-50d7-9305-8ae4926d4419","excerpt":"In software, coupling is often described as something intrinsic and fixed: code is either coupled or not. I’ve had this viewpoint challenged recently during a…","html":"<p>In software, coupling is often described as something intrinsic and fixed: code is either coupled or not. I’ve had this viewpoint challenged recently during a talk by Kent Beck, where he makes this statement (<a href=\"https://youtu.be/3gib0hKYjB0?t=840\">~14:00</a>):</p>\n<blockquote>\n<p>Coupling is always with respect to a particular change</p>\n</blockquote>\n<p>This formulation suggests we stop treating coupling as something that is strictly intrinsic to our code. Rather, we consciously (or sub-consciously) make coupling tradeoffs when choosing how to modularize our code.</p>\n<p>What does this mean for us? I had these takeaways from the talk:</p>\n<ul>\n<li>Not all coupling is obvious from the code - a new change may reveal hidden coupling. Thus, observation should be an important part of developing new features.</li>\n<li>Coupling is difficult to completely eliminate from a large system, YAGNI<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> is a good perspective when making coupling tradeoffs.</li>\n<li>Refactoring is an important part of the toolbox - it helps us change our coupling tradeoffs.</li>\n</ul>\n<p>Before we look at each point in detail, let’s align on our understanding of coupling.</p>\n<h2 id=\"what-is-coupling\" style=\"position:relative;\"><a href=\"#what-is-coupling\" aria-label=\"what is coupling permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Coupling?</h2>\n<p>Beck gives a pretty simple definition of coupling: given two software “elements” (this could be at multiple levels, from code modules to web services) and a requested change, the elements are coupled if both need to be modified to accomodate the change.</p>\n<p>I like how this hints at <em>why</em> decoupling is important - if we need to modify many elements to effect a change, that change is likely to be more costly. So a key advantage of decoupling is potentially reducing future cost.</p>\n<h2 id=\"an-example-extracting-twitters-algorithm\" style=\"position:relative;\"><a href=\"#an-example-extracting-twitters-algorithm\" aria-label=\"an example extracting twitters algorithm permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>An Example: Extracting Twitter’s “Algorithm”</h2>\n<p>In a <a href=\"https://blog.bethcodes.com/coupling-and-cohesion-how-musk-would-need-to-rearchitect-twitter\">blog post</a>, Beth Andres-Beck shares a great example of how coupling varies depending on the change required. Recently, Elon Musk mused about extracting and open-sourcing “Twitter’s algorithm”, and this is apparently no small feat. Beth observes that the difficulty is likely due to “the algorithm” being spread across multiple microservices.</p>\n<p>Note that this doesn’t mean that Twitter’s services are poorly designed - in fact, Beth argues:</p>\n<blockquote>\n<p>With respect to different changes, Twitter’s system is already <strong>highly cohesive</strong> and <strong>loosely coupled</strong>. Twitter grew revenue 16% yoy last quarter. It has recently made obvious strides in reducing harassment &#x26; abuse on the platform. All of that involved hundreds of engineers safely evolving running software.</p>\n</blockquote>\n<p>To illustrate, let’s assume multiple microservices are involved in determining a user’s feed:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 441px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4a92d4bf9cf17c40696bf6989ec0f3a7/efc6e/coupling_tradeoff.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.243243243243242%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQY0y2OzQ5GMBBF+wB23wuw9YpehcTT2BKJ1M9aixbTFhup+TJiN5mTe+5l67piVVXYNM0zTRNaa32e5xEisnme9TzPxH1d1564MQbiOA6KovgppW4hBJZl+XDOkVwMAJBCUsqHbuecz7IsYoyxZVn0vu84TZOXUnpjzCsMwzAAgN+yLDdxylKZcw7Ztm3Yti12Xfd8AZ8kySscx1FrrZFz7vu+98dx0ApgjAXnef6klLdSivgzDANe14WMJCQFgIcaAMCnafoKhRD6457+xLdtgyiKAmvtK/z4O8Zai389lgTFTZL2qgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"coupling_tradeoff.png\"\n        title=\"coupling_tradeoff.png\"\n        src=\"/static/4a92d4bf9cf17c40696bf6989ec0f3a7/efc6e/coupling_tradeoff.png\"\n        srcset=\"/static/4a92d4bf9cf17c40696bf6989ec0f3a7/12f09/coupling_tradeoff.png 148w,\n/static/4a92d4bf9cf17c40696bf6989ec0f3a7/e4a3f/coupling_tradeoff.png 295w,\n/static/4a92d4bf9cf17c40696bf6989ec0f3a7/efc6e/coupling_tradeoff.png 441w\"\n        sizes=\"(max-width: 441px) 100vw, 441px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In daily work, a dev working on Service A would have been able to make modifications without touching other services. From that perspective, the services were loosely coupled.</p>\n<p>However, to extract out “the algorithm”, all the services would need to be modified i.e. from this perspective, they are coupled.</p>\n<h2 id=\"not-all-coupling-is-discernible-from-the-code\" style=\"position:relative;\"><a href=\"#not-all-coupling-is-discernible-from-the-code\" aria-label=\"not all coupling is discernible from the code permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Not all coupling is discernible from the code</h2>\n<p>In Kent Beck’s talk, he also mentions that the most expensive couplings are the ones “you don’t see”. His <a href=\"https://youtu.be/3gib0hKYjB0?t=1473\">example</a> is somewhat extreme: a change in the backup schedule of an application blocked connections and starved other applications on the same server rack.</p>\n<p>John Ousterhout<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup> gives a more relatable example - changing the background colours in a website. If the colours were defined in an inline style on each page, a developer would need to modify all pages. Yet, this coupling (Ousterhout refers to this as “complexity”) isn’t obvious from characteristics of the code itself - there aren’t any shared dependencies.</p>\n<p>My takeaway? When there are new requirements or changes needed, observe which code needs to be modified. Do you need to modify code in multiple modules or services? That is a sign that they are coupled with respect to that change, and may need to be refactored to make those modifications easier. In the background colour example, this might mean some central variable to control the colour (you could argue this introduces a coupling to that central stylesheet).</p>\n<h2 id=\"coupling-is-difficult-to-completely-eliminate-from-a-large-system\" style=\"position:relative;\"><a href=\"#coupling-is-difficult-to-completely-eliminate-from-a-large-system\" aria-label=\"coupling is difficult to completely eliminate from a large system permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coupling is difficult to completely eliminate from a large system</h2>\n<p>Following on from the server rack example, Kent Beck emphasises that the bigger and more complex the system, the more likely you’d find “weird, action at a distance coupling”.</p>\n<p>Even if we break our logic into small, composable parts, those parts need to be combined and orchestrated. This gets repeated at multiple levels in software (from modules to services etc.), creating coupling based on how those parts are composed.</p>\n<p>The Twitter example shows that a choice was made to decouple a certain “axis”, spreading the generation of a user’s feed across multiple services. This allowed the company to iterate and evolve quickly, with the tradeoff that it was difficult to extract and isolate the algorithm as a whole.</p>\n<p>So perhaps it’s worth thinking of coupling as a tradeoff, rather than a fixed property. We decide certain changes are more important to enable today and decouple along those axes, knowing the result could still be coupled from certain perspectives.</p>\n<h2 id=\"refactoring-is-important\" style=\"position:relative;\"><a href=\"#refactoring-is-important\" aria-label=\"refactoring is important permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refactoring is important</h2>\n<p>Earlier, I chose to emphasise observation of changes over speculation, because it’s very easy to get it wrong and cause more harm than good. It’s more important to be able to adapt, and that’s why it’s important to get good at refactoring. To quote Kent Beck from <a href=\"https://tidyfirst.substack.com/p/tldr-coupling-and-later-cohesion/comment/4965495?s=r\">elsewhere</a>:</p>\n<blockquote>\n<p>You might be able to guess that I care less about predicting the future than in doing a good job with the present and adapting flexibly to learning and surprises.</p>\n</blockquote>\n<p>I’ll lean on Beth Andres-Beck’s example again, where he too invokes YAGNI (you ain’t gonna need it):</p>\n<blockquote>\n<p>Imagine that Twitter had guessed that a billionaire would get mad about an ad they showed him. They might have spent a similar amount of time &#x26; effort as this project will take today making the ad targeting logic cohesive &#x26; decoupled. The code still wouldn’t be any more cohesive or loosely coupled with regards to the change that [Elon Musk] actually wants. It would have cost a bunch of money to do, making all the other work over the years harder, and it still wouldn’t make this change any easier.</p>\n<p>Attempting to anticipate the future doesn’t help us build systems that can adapt to it.</p>\n</blockquote>\n<p>So, prioritise getting good at (1) observing the system to identify coupling and (2) knowing how to refactor safely, rather than getting better at speculating future requirements. Refactoring should be seen as an essential part of our toolbox for attaining “low coupling and high cohesion”.</p>\n<p>(Note that the above refers to <em>guessing future requirements</em>, as opposed to the requirements themselves being speculative. I think the latter is somewhat true most of the time - you don’t truly know if a feature is going to be a success until it’s out in the wild.)</p>\n<h2 id=\"afterword\" style=\"position:relative;\"><a href=\"#afterword\" aria-label=\"afterword permalink\" class=\"autolink-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Afterword</h2>\n<p>I only touched on coupling in this post, but Kent Beck also talks about cohesion in his talk - it’s a good watch, though you may want to skip the first 9 minutes of banter. Here’s a <a href=\"https://youtu.be/3gib0hKYjB0?t=545\">good timestamp</a> to start from.</p>\n<p>Personally, I hope to revisit this post with more concrete, personal examples. Also, few things are truly black-and-white in software design - let’s see if I still agree with these takeaways or develop more nuance as time progresses.</p>\n<p>In the meantime, I’d love to hear your thoughts and discuss further - feel free to tweet or leave a comment!</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">You Aren’t Gonna Need It, an acronym coined by Kent Beck. <a href=\"https://martinfowler.com/bliki/Yagni.html\">Here’s</a> a detailed explanation by Martin Fowler.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">A Philosophy of Software Design, Chapter 2.3<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","frontmatter":{"title":"Coupling is a Tradeoff","date":"June 08, 2022","updated_date":null,"description":"Coupling is usually described as something intrinsic: code is either coupled or not. But Kent Beck argues that it is always with respect to a particular change. What does that mean for us?"}}},"pageContext":{"slug":"/blog/coupling-and-cohesion-is-a-tradeoff/","previous":{"fields":{"slug":"/blog/zettelkasten-and-how-to-take-smart-notes/"},"frontmatter":{"title":"Zettelkasten from \"How to take Smart Notes\"","tags":["knowledge-management"],"date":"2022-04-16","updated_date":null}},"next":{"fields":{"slug":"/blog/overspecifying-tests-the-employee-report-kata/"},"frontmatter":{"title":"Overspecifying Tests - the Employee Report Kata","tags":["katas","testing"],"date":"2022-06-22","updated_date":null}},"relatedPosts":[{"node":{"fields":{"slug":"/blog/visitor-pattern-in-ruby-rubocop/"},"frontmatter":{"title":"Visitor Pattern in Ruby: Examples from Rubocop","tags":["design-patterns","software-design"],"date":"2022-08-09","updated_date":"2022-09-08"}}},{"node":{"fields":{"slug":"/blog/why-is-polymorphism-important/"},"frontmatter":{"title":"Why use Polymorphism in OOP?","tags":["object-oriented","software-design","dependency-inversion-principle"],"date":"2022-03-20","updated_date":null}}}],"updatedDate":"2022-06-08"}},
    "staticQueryHashes": ["2744205926","2841359383"]}